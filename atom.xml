<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>running-in-sky</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://www.zzzhy.cn/"/>
  <updated>2019-12-04T14:39:40.855Z</updated>
  <id>http://www.zzzhy.cn/</id>
  
  <author>
    <name>zzzhy</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>service-mesh-op-with-istio</title>
    <link href="http://www.zzzhy.cn/2019/12/04/service-mesh-op-with-istio/"/>
    <id>http://www.zzzhy.cn/2019/12/04/service-mesh-op-with-istio/</id>
    <published>2019-12-04T14:37:08.000Z</published>
    <updated>2019-12-04T14:39:40.855Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æœåŠ¡æ²»ç†çš„ä¸‰ç§å‘å±•å½¢æ€"><a href="#æœåŠ¡æ²»ç†çš„ä¸‰ç§å‘å±•å½¢æ€" class="headerlink" title="æœåŠ¡æ²»ç†çš„ä¸‰ç§å‘å±•å½¢æ€"></a>æœåŠ¡æ²»ç†çš„ä¸‰ç§å‘å±•å½¢æ€</h3><ul><li>åº”ç”¨ç¨‹åºä¸­åŒ…å«æ²»ç†é€»è¾‘</li><li>æ²»ç†é€»è¾‘ç‹¬ç«‹çš„ä»£ç ï¼ˆSDKæ¨¡å¼ï¼‰</li><li>æ²»ç†é€»è¾‘ç‹¬ç«‹çš„è¿›ç¨‹ï¼ˆSIDECARæ¨¡å¼ï¼‰</li></ul><h3 id="spring-cloud-k8s-ä¸-istio-k8sçš„æ¯”è¾ƒ"><a href="#spring-cloud-k8s-ä¸-istio-k8sçš„æ¯”è¾ƒ" class="headerlink" title="spring cloud + k8s ä¸ istio + k8sçš„æ¯”è¾ƒ"></a>spring cloud + k8s ä¸ istio + k8sçš„æ¯”è¾ƒ</h3><table><thead><tr><th>é¡¹ç›®</th><th>istio + k8s</th><th>spring cloud + k8s</th></tr></thead><tbody><tr><td>æ¶æ„è®¾è®¡</td><td>åŸºäºKubernetesèƒ½åŠ›æ„å»º</td><td>å’ŒKubernetesæ— ç»“åˆ</td></tr><tr><td>æœåŠ¡å‘ç°</td><td>ä½¿ç”¨k8sæœåŠ¡åï¼Œå’Œk8sä¸€è‡´çš„æœåŠ¡å‘ç°æœºåˆ¶</td><td>ä¸¤å¥—æœåŠ¡å‘ç°ã€‚æœ‰æœåŠ¡å‘ç°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚k8sä¸­podçš„æ­£å¸¸æ­‰æ„ä¼šå¼•èµ·é‡æ–°è¿›è¡ŒæœåŠ¡æ³¨å†Œ</td></tr><tr><td>ä½¿ç”¨ä½“éªŒ</td><td>å®Œå…¨çš„k8sä½¿ç”¨ä½“éªŒã€‚sidecarè‡ªåŠ¨æ³¨å…¥podï¼Œä¸šåŠ¡æ— æ„ŸçŸ¥ï¼Œå’Œéƒ¨ç½²æ™®é€šk8sæœåŠ¡æ— å·®åˆ«ã€‚</td><td>å’Œk8sæ— ç»“åˆï¼Œk8såªæ˜¯æä¾›äº†è¿è¡Œç¯å¢ƒ</td></tr><tr><td>æ§åˆ¶é¢</td><td>æ— åºé¢å¤–çš„APIServerå’Œè§„åˆ™ç­–ç•¥å®šä¹‰ã€‚åŸºäºk8s CRDè¿›è¡Œæ‰©å±•ã€‚</td><td>éœ€è‡ªè¡Œå®‰è£…å’Œç»´æŠ¤æ§åˆ¶é¢æ¥ç®¡ç†æ²»ç†è§„åˆ™ã€‚</td></tr></tbody></table><h3 id="istioçš„å‡ ä¸ªçº¦æŸ"><a href="#istioçš„å‡ ä¸ªçº¦æŸ" class="headerlink" title="istioçš„å‡ ä¸ªçº¦æŸ"></a>istioçš„å‡ ä¸ªçº¦æŸ</h3><ul><li><p>ç«¯å£å‘½åï¼š</p><p>æœåŠ¡ç«¯å£å¿…é¡»è¿›è¡Œå‘½åï¼Œè€Œä¸”åç§°åªèƒ½æ˜¯protocol[-<suffix>]å½¢å¼ï¼Œprotocolå¯ä»¥ä½¿tcpã€httpã€http2ã€httpsã€mysqlã€redisç­‰ã€‚istioæ ¹æ®ç«¯å£å®šä¹‰çš„åè®®æä¾›å¯¹åº”çš„è·¯ç”±èƒ½åŠ›ã€‚å¦‚æœç«¯å£æœªå‘½åæˆ–æ²¡æœ‰åŸºäºè¿™ç§æ ¼å¼ï¼Œåˆ™ç«¯å£çš„æµé‡ä¼šå½“æˆtcpæµé‡æ¥å¤„ç†ã€‚</p></li><li><p>æœåŠ¡å…³è”</p><p>å¦‚æœä¸€ä¸ªpodå±äºå¤šä¸ªk8sæœåŠ¡ï¼Œåˆ™è¦æ±‚æœåŠ¡ä¸èƒ½å†åŒä¸€ä¸ªç«¯å£ä½¿ç”¨ä¸åŒçš„åè®®ã€‚</p></li><li><p>Deploymentä½¿ç”¨appå’Œversionæ ‡ç­¾ï¼š</p><p>æ¯ä¸ªdeploymentéƒ½éœ€è¦ä¸€ä¸ªæœ‰ä¸šåŠ¡æ„ä¹‰çš„appæ ‡ç­¾å’Œä¸€ä¸ªè¡¨ç¤ºç‰ˆæœ¬çš„versionæ ‡ç­¾ã€‚åˆ†å¸ƒå¼è¿½è¸ªå¯ä»¥é€šè¿‡appæ ‡ç­¾è¡¥é½ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè¿˜å¯ä»¥é€šè¿‡appå’Œversionä¸ºé¥æµ‹æ•°æ®è¡¥é½ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</p></li></ul><h3 id="openshift-deployç»„ä»¶çš„æ³¨å…¥é—®é¢˜"><a href="#openshift-deployç»„ä»¶çš„æ³¨å…¥é—®é¢˜" class="headerlink" title="openshift deployç»„ä»¶çš„æ³¨å…¥é—®é¢˜"></a>openshift deployç»„ä»¶çš„æ³¨å…¥é—®é¢˜</h3><p>å½“å¼€å¯äº†namespaceçš„è‡ªåŠ¨æ³¨å…¥ï¼Œåˆæ˜¯åœ¨ç”¨openshiftçš„deployè¿›è¡ŒæœåŠ¡éƒ¨ç½²æ—¶ï¼Œä¼šå‘ç”Ÿdeployç»„ä»¶completeä¹‹åistio-proxyå®¹å™¨ä¸ä¼šåœæ­¢ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸‹istio-injectçš„ConfigMapé…ç½®ï¼š</p><p>å½“æ£€æµ‹åˆ°</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">neverInjectSelector:</span></span><br><span class="line"><span class="attr">  - matchExpressions:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">&#123;key:</span> <span class="string">openshift.io/build.name,</span> <span class="attr">operator:</span> <span class="string">Exists&#125;</span></span><br><span class="line"><span class="attr">  - matchExpressions:</span></span><br><span class="line"><span class="bullet">    -</span> <span class="string">&#123;key:</span> <span class="string">openshift.io/deployer-pod-for.name,</span> <span class="attr">operator:</span> <span class="string">Exists&#125;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;æœåŠ¡æ²»ç†çš„ä¸‰ç§å‘å±•å½¢æ€&quot;&gt;&lt;a href=&quot;#æœåŠ¡æ²»ç†çš„ä¸‰ç§å‘å±•å½¢æ€&quot; class=&quot;headerlink&quot; title=&quot;æœåŠ¡æ²»ç†çš„ä¸‰ç§å‘å±•å½¢æ€&quot;&gt;&lt;/a&gt;æœåŠ¡æ²»ç†çš„ä¸‰ç§å‘å±•å½¢æ€&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;åº”ç”¨ç¨‹åºä¸­åŒ…å«æ²»ç†é€»è¾‘&lt;/li&gt;
&lt;li&gt;æ²»ç†é€»è¾‘ç‹¬ç«‹çš„
      
    
    </summary>
    
    
      <category term="cloud native" scheme="http://www.zzzhy.cn/categories/cloud-native/"/>
    
    
      <category term="cloud native,istio,k8s" scheme="http://www.zzzhy.cn/tags/cloud-native-istio-k8s/"/>
    
  </entry>
  
  <entry>
    <title>ç†è§£kubernetesæ¶æ„åŠç»„ä»¶</title>
    <link href="http://www.zzzhy.cn/2019/11/13/k8s-arch/"/>
    <id>http://www.zzzhy.cn/2019/11/13/k8s-arch/</id>
    <published>2019-11-13T15:12:00.000Z</published>
    <updated>2019-11-14T16:29:48.607Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Kubernetesé›†ç¾¤æ¶æ„"><a href="#Kubernetesé›†ç¾¤æ¶æ„" class="headerlink" title="Kubernetesé›†ç¾¤æ¶æ„"></a>Kubernetesé›†ç¾¤æ¶æ„</h3><img src="/uploads/k8s-arch.png" alt="image-20191113230229077" style="zoom:50%;" /><h4 id="æ§åˆ¶é¢æ¿"><a href="#æ§åˆ¶é¢æ¿" class="headerlink" title="æ§åˆ¶é¢æ¿"></a>æ§åˆ¶é¢æ¿</h4><p>åŒ…å«å¤šä¸ªç»„ä»¶ï¼Œç»„ä»¶åˆ†åˆ«éƒ¨ç½²åœ¨å¤šä¸ªä¸»èŠ‚ç‚¹ä¿è¯é«˜å¯ç”¨ï¼š</p><ul><li>Kubernetes APIæœåŠ¡å™¨</li><li>Scheduler</li><li>Controller Manager æ‰§è¡Œé›†ç¾¤çº§åˆ«çš„ä»»åŠ¡ï¼Œå¦‚å¤åˆ¶ç»„ä»¶ã€æŒç»­è·Ÿè¸ªå·¥ä½œèŠ‚ç‚¹ã€å¤„ç†èŠ‚ç‚¹å¤±è´¥ç­‰</li><li>etcd æŒä¹…åŒ–å­˜å‚¨é›†ç¾¤é…ç½®</li></ul><h4 id="å·¥ä½œèŠ‚ç‚¹"><a href="#å·¥ä½œèŠ‚ç‚¹" class="headerlink" title="å·¥ä½œèŠ‚ç‚¹"></a>å·¥ä½œèŠ‚ç‚¹</h4><p>è¿è¡Œå®¹å™¨åŒ–åº”ç”¨çš„æœºå™¨ï¼Œä¹ŸåŒ…å«å¤šä¸ªç»„ä»¶ï¼š</p><ul><li>Dockerã€rtkæˆ–å…¶ä»–çš„å®¹å™¨ç±»å‹</li><li>Kubeletï¼Œä»–ä¸APIæœåŠ¡å™¨é€šä¿¡ï¼Œç®¡ç†ä»–æ‰€åœ¨èŠ‚ç‚¹çš„å®¹å™¨</li><li>Kubernetes Service Proxyï¼ˆkube-proxyï¼‰è´Ÿè´£ç»„ä»¶ä¹‹é—´çš„è´Ÿè½½å‡è¡¡ç½‘ç»œæµé‡</li></ul><h3 id="Kubernetes-å¼ºå¤§çš„æ ‡ç­¾"><a href="#Kubernetes-å¼ºå¤§çš„æ ‡ç­¾" class="headerlink" title="Kubernetes å¼ºå¤§çš„æ ‡ç­¾"></a>Kubernetes å¼ºå¤§çš„æ ‡ç­¾</h3><h4 id="kubernetesæ ‡ç­¾é€‰æ‹©å™¨"><a href="#kubernetesæ ‡ç­¾é€‰æ‹©å™¨" class="headerlink" title="kubernetesæ ‡ç­¾é€‰æ‹©å™¨"></a>kubernetesæ ‡ç­¾é€‰æ‹©å™¨</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ ¹æ®æ ‡ç­¾å€¼ç­›é€‰</span></span><br><span class="line">kubectl get po -l createion_method=manual</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºåŒ…å«æŸæ ‡ç­¾çš„pod</span></span><br><span class="line">kubectl get po -l env</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºä¸å­˜åœ¨æŸæ ‡ç­¾</span></span><br><span class="line">kubectl get po -l <span class="string">'!env'</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºå€¼åŒ¹é…çš„</span></span><br><span class="line">kubectl get po -l create_method!=manual</span><br><span class="line">kubectl get po -l env <span class="keyword">in</span> (prod,dev)</span><br><span class="line">kubectl get po -l env notin (prod,dev)</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¤šæ¡ä»¶</span></span><br><span class="line">kubect get po -l app=pc,env=prod</span><br></pre></td></tr></table></figure><h4 id="åˆ©ç”¨æ ‡ç­¾çº¦æŸpodè°ƒåº¦"><a href="#åˆ©ç”¨æ ‡ç­¾çº¦æŸpodè°ƒåº¦" class="headerlink" title="åˆ©ç”¨æ ‡ç­¾çº¦æŸpodè°ƒåº¦"></a>åˆ©ç”¨æ ‡ç­¾çº¦æŸpodè°ƒåº¦</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. åˆ©ç”¨æ ‡ç­¾åˆ†ç±»å·¥ä½œèŠ‚ç‚¹</span></span><br><span class="line">kubectl label node xxxxxxxxxxx gpu=<span class="literal">true</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 2. å°†podè°ƒåº¦åˆ°gpuèŠ‚ç‚¹</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Pod</span><br><span class="line">metadata:</span><br><span class="line">  name: kubia-gpu</span><br><span class="line">spec:</span><br><span class="line">  nodeSelector:</span><br><span class="line">    gpu: <span class="literal">true</span>        <span class="comment"># è¦æ±‚k8så°†podéƒ¨ç½²åœ¨gpuèŠ‚ç‚¹</span></span><br><span class="line">  containers:</span><br><span class="line">  - image: lukas/kubia</span><br><span class="line">    name: kubia</span><br></pre></td></tr></table></figure><h3 id="Kubernetesæ¢é’ˆ"><a href="#Kubernetesæ¢é’ˆ" class="headerlink" title="Kubernetesæ¢é’ˆ"></a>Kubernetesæ¢é’ˆ</h3><h4 id="å­˜æ´»æ¢é’ˆliveness-probe"><a href="#å­˜æ´»æ¢é’ˆliveness-probe" class="headerlink" title="å­˜æ´»æ¢é’ˆliveness probe"></a>å­˜æ´»æ¢é’ˆliveness probe</h4><ul><li>HTTP Get æ¢é’ˆã€‚è¿”å›ç ä¸º2xxæˆ–3xxï¼Œåˆ™è®¤ä¸ºæˆåŠŸï¼Œå¦åˆ™å®¹å™¨å°†è¢«é‡æ–°å¯åŠ¨</li><li>TCPå¥—æ¥å­—æ¢é’ˆã€‚å°è¯•ä¸å®¹å™¨æŒ‡å®šç«¯å£å»ºç«‹å¥—æ¥å­—é“¾æ¥</li><li>Execæ¢é’ˆã€‚åœ¨å®¹å™¨å†…æ‰§è¡Œä»»æ„å‘½ä»¤å¹¶æ£€æŸ¥å‘½ä»¤çš„é€€å‡ºå‘½ä»¤ç ï¼Œæ­£å¸¸é€€å‡ºç ä¸º0</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kubia-liveness</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  containers:</span></span><br><span class="line"><span class="attr">  - image:</span> <span class="string">luksa/kubia-unhealthy</span></span><br><span class="line"><span class="attr">    name:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">    livenessProbe:</span></span><br><span class="line"><span class="attr">      httpGet:</span></span><br><span class="line"><span class="attr">        path:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">        port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">      initialDelaySeconds:</span> <span class="number">10</span></span><br></pre></td></tr></table></figure><h4 id="å°±ç»ªæ¢é’ˆreadinessProbe"><a href="#å°±ç»ªæ¢é’ˆreadinessProbe" class="headerlink" title="å°±ç»ªæ¢é’ˆreadinessProbe"></a>å°±ç»ªæ¢é’ˆreadinessProbe</h4><p>å’Œå­˜æ´»æ¢é’ˆä¸€æ ·çš„ç±»å‹ç§ç±»</p><h3 id="Kubernetes-ReplicationController"><a href="#Kubernetes-ReplicationController" class="headerlink" title="Kubernetes ReplicationController"></a>Kubernetes ReplicationController</h3><ol><li>å¥½å¤„<ul><li>ç¡®ä¿ä¸€ä¸ªæˆ–å¤šä¸ªpodå‰¯æœ¬æŒç»­è¿è¡Œï¼Œpodæ•…éšœåä¼šè‡ªåŠ¨å¯åŠ¨ä¸€ä¸ªæ–°çš„pod</li><li>èŠ‚ç‚¹æ•…éšœåä¹Ÿä¼šåœ¨å…¶ä»–èŠ‚ç‚¹åˆ›å»ºæ›¿ä»£å‰¯æœ¬ï¼šèŠ‚ç‚¹æ•…éšœæ—¶èŠ‚ç‚¹çŠ¶æ€å˜ä¸ºNotReadyã€‚k8sä¼šç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç„¶åå°†podçŠ¶æ€å˜æˆUnknownï¼Œç„¶åç«‹å³å¯åŠ¨ä¸€ä¸ªæ–°çš„pod</li><li>è½»æ¾å®ç°podçš„æ°´å¹³ä¼¸ç¼©</li></ul></li><li>å®šä¹‰</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicationController</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kubia</span><span class="comment">#ReplicationControlleråå­—</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span><span class="comment">#podå‰¯æœ¬æ•°</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">  template:</span><span class="comment">#ReplicationControllerç®¡ç†çš„podçš„æ¨¡æ¿</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">kubia</span><span class="comment">#podçš„æ ‡ç­¾</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">luksa/kubia</span></span><br><span class="line"><span class="attr">        ports:</span></span><br><span class="line"><span class="attr">        - containerPort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure><ol start="3"><li><p>é’ˆå¯¹ä¿®æ”¹â€”å…³äºæ ‡ç­¾å’Œæ¨¡æ¿</p><ul><li><p>åˆ é™¤ReplicationControlleræ—¶ä¼šè¿å¸¦åˆ é™¤æ‰å®ƒæ‰€ç®¡ç†çš„æ‰€æœ‰pod</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¯ä»¥é€šè¿‡å¢åŠ cascadeä¿æŒpodè¿è¡Œ</span></span><br><span class="line">kubectl delete rc kubia --cascade=<span class="literal">false</span></span><br></pre></td></tr></table></figure></li><li><p>ReplicationControllerè¿è¡Œåæ–°å¢podæ ‡ç­¾ä¸ä¼šå½±å“ReplicationControllerçš„å‰¯æœ¬æ•°ç›®</p></li><li><p>åˆ é™¤æˆ–ä¿®æ”¹podçš„selectoræ ‡ç­¾ï¼Œè¯¥podå°†è¢«ç§»å‡ºReplicationControllerçš„ç®¡ç†ï¼ŒReplicationControllerä¼šæ–°å»ºä¸€ä¸ªpodä¿è¯å‰¯æœ¬æ•°</p></li><li><p>ä¿®æ”¹ReplicationControllerçš„æ¨¡æ¿ä¸ä¼šå¯¹å½“å‰podé€ æˆå½±å“ï¼Œåªä¼šå½±å“ä¹‹åæ–°å»ºçš„pod</p></li></ul></li><li><p>ä¼¸ç¼©</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl scale rc kubia --replicas=5</span><br></pre></td></tr></table></figure><h3 id="Kubernetes-ReplicaSet"><a href="#Kubernetes-ReplicaSet" class="headerlink" title="Kubernetes ReplicaSet"></a>Kubernetes ReplicaSet</h3><p>ReplicationControllerçš„æ›¿ä»£ã€‚</p><p>è¡Œä¸ºä¸ReplicationControllerä¸€è‡´ï¼Œä½†æ˜¯podé€‰æ‹©å™¨çš„è¡¨è¾¾èƒ½åŠ›æ›´å¼ºã€‚æ¯”å¦‚ReplicaSetå¯ä»¥åŒæ—¶åŒ¹é…å¤šç»„æ ‡ç­¾ï¼Œè€Œä¸”å¯ä»¥åŸºäºæ ‡ç­¾åçš„å­˜åœ¨æ€§æ¥åŒ¹é…ã€‚</p><ol><li><p>å®šä¹‰</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicaSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  replicas:</span> <span class="number">3</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span><span class="comment">#å¤šä¸ªæ ‡ç­¾çš„åŒ¹é…ï¼Œä¹Ÿå¯ä»¥æ˜¯</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">luksa/kubia</span></span><br></pre></td></tr></table></figure></li><li><p>å¢å¼ºå‹æ ‡ç­¾é€‰æ‹©å™¨</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">selector:</span></span><br><span class="line"><span class="attr">  matchExpressions:</span></span><br><span class="line"><span class="attr">    - key:</span> <span class="string">app</span>  <span class="comment"># æ ‡ç­¾åå­—</span></span><br><span class="line">      <span class="comment">#In NotIn Exists(åŒ…å«ï¼Œä¸æŒ‡å®švalues) DoesNotExistï¼ˆä¸å¾—åŒ…å«ï¼Œä¸æŒ‡å®švaluesï¼‰</span></span><br><span class="line"><span class="attr">      operator:</span> <span class="string">In</span>     </span><br><span class="line"><span class="attr">      values:</span></span><br><span class="line"><span class="bullet">        -</span> <span class="string">kubia</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="Kubernetes-DaemonSet"><a href="#Kubernetes-DaemonSet" class="headerlink" title="Kubernetes DaemonSet"></a>Kubernetes DaemonSet</h3><p>åœ¨åŒ¹é…æŸæ ‡ç­¾çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå¯åŠ¨ä¸€ä¸ªDaemon podã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">ssd-monitor-ds</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    matchLabels:</span></span><br><span class="line"><span class="attr">      app:</span> <span class="string">ssd-monitor</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">ssd-monitor</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      nodeSelector:</span></span><br><span class="line"><span class="attr">        disk:</span> <span class="string">ssd</span>      <span class="comment"># æ¯ä¸ªæ ‡è®°ä¸ºssdçš„èŠ‚ç‚¹éƒ½ä¼šéƒ¨ç½²ä¸€ä¸ªæ ‡è®°labelä¸ºssd-monitorçš„pod</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">main</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">luksa/ssd-monitor</span></span><br></pre></td></tr></table></figure><p>å¦‚æœèŠ‚ç‚¹çš„æ ‡ç­¾ä»ssdä¿®æ”¹ä¸ºhddï¼Œåˆ™å¯¹åº”çš„podä¹Ÿä¼šè·Ÿç€ç»ˆæ­¢æ‰ã€‚</p><h3 id="Kubernetes-Job"><a href="#Kubernetes-Job" class="headerlink" title="Kubernetes Job"></a>Kubernetes Job</h3><p>Jobçš„å†…éƒ¨è¿›ç¨‹æˆåŠŸç»“æŸåï¼Œä¸é‡å¯å®¹å™¨ï¼Œå¤„äºå®ŒæˆçŠ¶æ€ã€‚å¦‚æœè¿›ç¨‹å¼‚å¸¸é€€å‡ºï¼Œå¯ä»¥å°†Jobé…ç½®ä¸ºé‡æ–°å¯åŠ¨ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">batch-job</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">batch-job</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      restartPolicy:</span> <span class="string">OnFailure</span>      <span class="comment"># ä¸èƒ½è®¾ç½®ä¸ºAlwaysè‡ªåŠ¨é‡å¯</span></span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">main</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">luksa/batch-job</span></span><br></pre></td></tr></table></figure><p>Jobå¯ä»¥åˆ›å»ºå¤šä¸ªpodå®ä¾‹ï¼Œä¸€å¹¶è¡Œæˆ–ä¸²è¡Œæ–¹å¼è¿è¡Œã€‚é€šè¿‡é…ç½®completionså’Œparallelismå±æ€§ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">multi-completion-batch-job</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  completion:</span> <span class="number">5</span></span><br><span class="line"><span class="attr">  parallelism:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">  template:</span></span><br><span class="line"><span class="attr">    metadata:</span></span><br><span class="line"><span class="attr">      labels:</span></span><br><span class="line"><span class="attr">        app:</span> <span class="string">batch-job</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      restartPolicy:</span> <span class="string">OnFailure</span>  </span><br><span class="line"><span class="attr">      containers:</span></span><br><span class="line"><span class="attr">      - name:</span> <span class="string">main</span></span><br><span class="line"><span class="attr">        image:</span> <span class="string">luksa/batch-job</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œé€»è¾‘ï¼šç¬¬ä¸€ä¸ªpodè¿è¡Œå®Œæˆï¼Œç»§ç»­åˆ›å»ºç¬¬äºŒä¸ªï¼Œç›¸å½“äºç›¸åŒçš„é€»è¾‘èµ·5æ¬¡podæ¥æ‰§è¡Œã€‚</p><p>å½“parallelism&gt;1æ—¶ï¼Œè¡¨ç¤ºå¯ä»¥åŒæ—¶æœ‰parallelismä¸ªpodåŒæ—¶è¿è¡Œã€‚</p><h4 id="CronJob"><a href="#CronJob" class="headerlink" title="CronJob"></a>CronJob</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">batch-job-every-fifteen-minutes</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  schedule:</span> <span class="string">"0,15,30,45 * * * *"</span>  <span class="comment"># æ¯å°æ—¶0ï¼Œ15ï¼Œ30ï¼Œ45åˆ†æ‰§è¡Œ</span></span><br><span class="line"><span class="attr">  jobTemplate:</span></span><br><span class="line"><span class="attr">    spec:</span></span><br><span class="line"><span class="attr">      template:</span></span><br><span class="line"><span class="attr">        metadata:</span></span><br><span class="line"><span class="attr">          labels:</span></span><br><span class="line"><span class="attr">            app:</span> <span class="string">periodic-batch-job</span></span><br><span class="line"><span class="attr">        spec:</span></span><br><span class="line"><span class="attr">          restartPolicy:</span> <span class="string">OnFailure</span></span><br><span class="line"><span class="attr">          containers:</span> </span><br><span class="line"><span class="attr">          - name:</span> <span class="string">main</span></span><br><span class="line"><span class="attr">            image:</span> <span class="string">luksa/batch-job</span></span><br></pre></td></tr></table></figure><h3 id="Kubernetes-Service-â€”-é›†ç¾¤å†…éƒ¨æœåŠ¡"><a href="#Kubernetes-Service-â€”-é›†ç¾¤å†…éƒ¨æœåŠ¡" class="headerlink" title="Kubernetes Service â€” é›†ç¾¤å†…éƒ¨æœåŠ¡"></a>Kubernetes Service â€” é›†ç¾¤å†…éƒ¨æœåŠ¡</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">spec:</span> </span><br><span class="line">  <span class="comment">#sessionAffinity: ClientIP  æ˜¯å¦ä¿æŒä¼šè¯äº²å’Œï¼Œæ‰€æœ‰æ¥è‡ªåŒä¸€ä¸ªclientipçš„è¯·æ±‚ä¼šå‘ç»™åŒä¸€ä¸ªpod</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">http</span>          <span class="comment"># ç«¯å£å‘½å</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">80</span>            <span class="comment"># æš´éœ²å‡ºå»çš„ç«¯å£</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">8080</span>    <span class="comment"># å®¹å™¨å†…éƒ¨çš„æœåŠ¡ç«¯å£ï¼Œè¿™é‡Œä¹Ÿå¯ä½¿ç”¨podé‡Œportsçš„åå­—ä»£æ›¿</span></span><br><span class="line"><span class="attr">  - name:</span> <span class="string">https</span></span><br><span class="line"><span class="attr">    port:</span> <span class="number">443</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">8443</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">kubia</span>          <span class="comment"># æ ‡ç­¾ä¸ºkubiaçš„podéƒ½å±äºè¿™ä¸ªæœåŠ¡</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">âœ  k8s-in-action kubectl get po</span><br><span class="line">NAME                                               READY   STATUS      RESTARTS   AGE</span><br><span class="line">batch-job-every-fifteen-minutes-1573700400-skbmv   0/1     Completed   0          10m</span><br><span class="line">batch-job-r9pkj                                    0/1     Completed   0          36m</span><br><span class="line">kubia-bbt27                                        1/1     Running     0          3m58s</span><br><span class="line">kubia-h5cjl                                        1/1     Running     0          3m58s</span><br><span class="line">kubia-ttv72                                        1/1     Running     0          3m58s</span><br><span class="line"></span><br><span class="line">âœ  k8s-in-action kubectl get svc</span><br><span class="line">NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">kubernetes   ClusterIP   10.96.0.1      &lt;none&gt;        443/TCP   10h</span><br><span class="line">kubia        ClusterIP   10.104.37.60   &lt;none&gt;        80/TCP    5m33s</span><br><span class="line"></span><br><span class="line">âœ  k8s-in-action kubectl <span class="built_in">exec</span> kubia-h5cjl -- curl -s http://10.104.37.60</span><br><span class="line">You<span class="string">'ve hit kubia-bbt27</span></span><br><span class="line"><span class="string">âœ  k8s-in-action kubectl exec kubia-h5cjl -- curl -s http://10.104.37.60</span></span><br><span class="line"><span class="string">You'</span>ve hit kubia-ttv72</span><br></pre></td></tr></table></figure><blockquote><p>â€“ åŒæ¨ªæ è¡¨ç¤ºkubectlå‘½ä»¤çš„ç»“æŸã€‚æ¨ªæ ä¹‹åçš„å†…å®¹æŒ‡éœ€è¦åœ¨podå†…éƒ¨æ‰§è¡Œçš„å‘½ä»¤ã€‚å¦‚æœåé¢çš„å‘½ä»¤ä¸å¸¦æ¨ªæ å‚æ•°ï¼Œå¦‚ä¸å¸¦-sï¼Œåˆ™åŒæ¨ªæ ä¸æ˜¯å¿…é¡»çš„ã€‚</p></blockquote><h3 id="Kubernetes-Endpoints-â€”-ä½¿ç”¨é›†ç¾¤å¤–éƒ¨æœåŠ¡"><a href="#Kubernetes-Endpoints-â€”-ä½¿ç”¨é›†ç¾¤å¤–éƒ¨æœåŠ¡" class="headerlink" title="Kubernetes Endpoints â€” ä½¿ç”¨é›†ç¾¤å¤–éƒ¨æœåŠ¡"></a>Kubernetes Endpoints â€” ä½¿ç”¨é›†ç¾¤å¤–éƒ¨æœåŠ¡</h3><p>é›†ç¾¤å†…éƒ¨æœåŠ¡ä¹Ÿæœ‰endpointsï¼Œé€šè¿‡å‘½ä»¤  <code>kubectl describe svc kubia</code> å¯ä»¥çœ‹åˆ°ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">âœ  k8s-in-action kubectl describe svc kubia</span><br><span class="line">Name:              kubia</span><br><span class="line">Namespace:         default</span><br><span class="line">Labels:            &lt;none&gt;</span><br><span class="line">Annotations:       kubectl.kubernetes.io/last-applied-configuration:</span><br><span class="line">                     &#123;<span class="string">"apiVersion"</span>:<span class="string">"v1"</span>,<span class="string">"kind"</span>:<span class="string">"Service"</span>,<span class="string">"metadata"</span>:&#123;<span class="string">"annotations"</span>:&#123;&#125;,<span class="string">"name"</span>:<span class="string">"kubia"</span>,<span class="string">"namespace"</span>:<span class="string">"default"</span>&#125;,<span class="string">"spec"</span>:&#123;<span class="string">"ports"</span>:[&#123;<span class="string">"port"</span>:80,<span class="string">"target...</span></span><br><span class="line"><span class="string">Selector:          app=kubia</span></span><br><span class="line"><span class="string">Type:              ClusterIP</span></span><br><span class="line"><span class="string">IP:                10.104.37.60</span></span><br><span class="line"><span class="string">Port:              &lt;unset&gt;  80/TCP</span></span><br><span class="line"><span class="string">TargetPort:        8080/TCP</span></span><br><span class="line"><span class="string">Endpoints:         172.17.0.6:8080,172.17.0.7:8080,172.17.0.8:8080</span></span><br><span class="line"><span class="string">Session Affinity:  ClientIP</span></span><br><span class="line"><span class="string">Events:            &lt;none&gt;</span></span><br></pre></td></tr></table></figure><p>æ‰‹å·¥é…ç½®çš„<code>endpoints</code>ä¸»è¦ç”¨æ¥é…ç½®é›†ç¾¤å¤–éƒ¨æœåŠ¡ã€‚</p><p>æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><p>åˆ›å»ºæ²¡æœ‰é€‰æ‹©å™¨çš„æœåŠ¡S</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">external-service</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">  - port:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure></li><li><p>ä¸ºæœåŠ¡Såˆ›å»º<code>Endpoints</code>èµ„æº</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Endpoints</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">external-service</span><span class="comment"># åç§°å¿…é¡»å’ŒæœåŠ¡åç§°ç›¸åŒ¹é…</span></span><br><span class="line"><span class="attr">subsets:</span></span><br><span class="line"><span class="attr">  - addressses:</span></span><br><span class="line"><span class="attr">    - ip:</span> <span class="number">11.11</span><span class="number">.11</span><span class="number">.11</span></span><br><span class="line"><span class="attr">    - ip:</span> <span class="number">22.22</span><span class="number">.22</span><span class="number">.22</span><span class="comment"># endpointçš„ipåœ°å€</span></span><br><span class="line"><span class="attr">    ports:</span></span><br><span class="line"><span class="attr">    - port:</span> <span class="number">80</span><span class="comment"># endpointçš„ç›®æ ‡ç«¯å£</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="æš´éœ²æœåŠ¡"><a href="#æš´éœ²æœåŠ¡" class="headerlink" title="æš´éœ²æœåŠ¡"></a>æš´éœ²æœåŠ¡</h3><ul><li><p>NodePortæ–¹å¼</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kubia-nodeport</span></span><br><span class="line"><span class="attr">spec:</span> </span><br><span class="line"><span class="attr">  type:</span> <span class="string">NodePort</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">  - port:</span> <span class="number">80</span>            <span class="comment"># æš´éœ²å‡ºå»çš„ç«¯å£</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">8080</span>    <span class="comment"># å®¹å™¨å†…éƒ¨çš„æœåŠ¡ç«¯å£ï¼Œè¿™é‡Œä¹Ÿå¯ä½¿ç”¨podé‡Œportsçš„åå­—ä»£æ›¿</span></span><br><span class="line"><span class="attr">    nodePort:</span> <span class="number">30123</span><span class="comment"># å¦‚æœä¸æŒ‡å®šï¼Œå°†éšæœºåˆ†é…ä¸€ä¸ªç«¯å£</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">kubia</span>          <span class="comment"># æ ‡ç­¾ä¸ºkubiaçš„podéƒ½å±äºè¿™ä¸ªæœåŠ¡</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">âœ  k8s-in-action kubectl apply -f kubia-svc-nodeport.yaml</span><br><span class="line">service/kubia-nodeport created</span><br><span class="line">âœ  k8s-in-action kubectl get svc</span><br><span class="line">NAME             TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">kubernetes       ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP        11h</span><br><span class="line">kubia-nodeport   NodePort    10.104.247.31   &lt;none&gt;        80:30123/TCP   4s</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œå¯ä»¥é€šè¿‡10.104.247.31:80, <node1>:30123, <node2>:30123å»è®¿é—®æœåŠ¡äº†ã€‚</p><p>minikubeç”¨æˆ·å¯ä»¥ç›´æ¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¿«é€ŸæŸ¥çœ‹nodeportæœåŠ¡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">âœ  k8s-in-action minikube service kubia-nodeport</span><br><span class="line">|-----------|----------------|-------------|---------------------------|</span><br><span class="line">| NAMESPACE |      NAME      | TARGET PORT |            URL            |</span><br><span class="line">|-----------|----------------|-------------|---------------------------|</span><br><span class="line">| default   | kubia-nodeport |             | http://192.168.64.2:30123 |</span><br><span class="line">|-----------|----------------|-------------|---------------------------|</span><br><span class="line">ğŸ‰  Opening service default/kubia-nodeport <span class="keyword">in</span> default browser...</span><br></pre></td></tr></table></figure></li><li><p>LoadBalanceæ–¹å¼</p><p>æ³¨ï¼šminikubeå½“å‰è¿˜ä¸æ”¯æŒ</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line"><span class="attr">  name:</span> <span class="string">kubia-loadbalancer</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">LoadBalancer</span></span><br><span class="line"><span class="attr">  ports:</span></span><br><span class="line"><span class="attr">  - port:</span> <span class="number">80</span></span><br><span class="line"><span class="attr">    targetPort:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">  selector:</span></span><br><span class="line"><span class="attr">    app:</span> <span class="string">kubia</span></span><br></pre></td></tr></table></figure></li><li><p>åˆ›å»ºIngressèµ„æº</p><p>æ¯ä¸ªLoadBalanceréƒ½éœ€è¦è‡ªå·±çš„è´Ÿè½½å‡è¡¡å™¨ä»¥åŠç‹¬æœ‰çš„å…¬æœ‰çš„IPåœ°å€ï¼Œè€ŒIngressåªéœ€è¦ä¸€ä¸ªå…¬ç½‘IPå°±èƒ½ä¸ºè®¸å¤šæœåŠ¡æä¾›è®¿é—®ã€‚è¿˜å¯ä»¥æä¾›åŸºäºCookieçš„ä¼šè¯äº²å’Œæ€§ï¼ˆsession affinityï¼‰ã€‚</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">  name:</span> <span class="string">kubia</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line"><span class="attr">  rules:</span></span><br><span class="line"><span class="attr">  - host:</span> <span class="string">kubia.example.com</span>  <span class="comment">#å°†åŸŸåæ˜ å°„åˆ°æœåŠ¡</span></span><br><span class="line"><span class="attr">    http:</span></span><br><span class="line"><span class="attr">      paths:</span></span><br><span class="line"><span class="attr">      - path:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">        backend:</span></span><br><span class="line"><span class="attr">          serviceName:</span> <span class="string">kubia-nodeport</span><span class="comment">#å°†æ‰€æœ‰è¯·æ±‚å‘ç»™nodeportæœåŠ¡çš„80ç«¯å£</span></span><br><span class="line"><span class="attr">          servicePort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><ol><li><p>å¯åŠ¨nodeportå’Œrs</p></li><li><p>è§£æhosts</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">echo</span> <span class="string">"<span class="variable">$(minikube ip)</span> kubia.example.com"</span> | sudo tee -a /etc/hosts</span><br></pre></td></tr></table></figure></li><li><p>è®¿é—®<a href="http://kubia.example.com" target="_blank" rel="noopener">http://kubia.example.com</a></p></li></ol></li></ul><p>â€‹       minikubeå¿…å¤‡ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼€å¯ingress</span></span><br><span class="line">âœ  minikube addons <span class="built_in">enable</span> ingress</span><br><span class="line"><span class="comment"># æ‰§è¡Œå®Œåçœ‹ä¸‹æ˜¯å¦ä¸‹è½½é•œåƒæˆåŠŸ,ä¸‹é¢ä¸‹è½½å¤±è´¥äº†</span></span><br><span class="line">âœ  k8s-in-action kubectl get pods -n kube-system</span><br><span class="line">NAME                                        READY   STATUS             RESTARTS   AGE</span><br><span class="line">coredns-67c766df46-6sxxr                    1/1     Running            1          12h</span><br><span class="line">coredns-67c766df46-jrmbn                    1/1     Running            1          12h</span><br><span class="line">etcd-minikube                               1/1     Running            1          12h</span><br><span class="line">kube-addon-manager-minikube                 1/1     Running            1          12h</span><br><span class="line">kube-apiserver-minikube                     1/1     Running            1          12h</span><br><span class="line">kube-controller-manager-minikube            1/1     Running            1          12h</span><br><span class="line">kube-proxy-9bxng                            1/1     Running            1          12h</span><br><span class="line">kube-scheduler-minikube                     1/1     Running            1          12h</span><br><span class="line">nginx-ingress-controller-6fc5bcc8c9-sxf25   0/1     ImagePullBackOff   0          8m45s</span><br><span class="line">storage-provisioner                         1/1     Running            1          12h</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;Kubernetesé›†ç¾¤æ¶æ„&quot;&gt;&lt;a href=&quot;#Kubernetesé›†ç¾¤æ¶æ„&quot; class=&quot;headerlink&quot; title=&quot;Kubernetesé›†ç¾¤æ¶æ„&quot;&gt;&lt;/a&gt;Kubernetesé›†ç¾¤æ¶æ„&lt;/h3&gt;&lt;img src=&quot;/uploads/k8s-ar
      
    
    </summary>
    
    
      <category term="cloud native" scheme="http://www.zzzhy.cn/categories/cloud-native/"/>
    
    
      <category term="kubernetes" scheme="http://www.zzzhy.cn/tags/kubernetes/"/>
    
  </entry>
  
  <entry>
    <title>æ•°æ®åº“ç´¢å¼•æ¼«è°ˆ</title>
    <link href="http://www.zzzhy.cn/2019/10/31/database-index-surfing/"/>
    <id>http://www.zzzhy.cn/2019/10/31/database-index-surfing/</id>
    <published>2019-10-30T16:06:04.000Z</published>
    <updated>2019-11-14T16:29:21.130Z</updated>
    
    <content type="html"><![CDATA[<p>ç´¢å¼•ç”Ÿæˆ</p><p>ç´¢å¼•ä¸ç´¢å¼•ç›´æ¥å¹¶æ— ç›´æ¥å…³è”ï¼Œä»–ä»¬æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚</p><ol><li><p>èšé›†ç´¢å¼•</p><p> å½“æˆ‘ä»¬ç»™ä¸€ä¸ªæ•°æ®åº“è¡¨åˆ†é…ä¸€ä¸ªä¸»é”®æ—¶ï¼Œè¿™æ—¶å°±ä¼šç”Ÿæˆä¸€æ£µå¹³è¡¡æ ‘ç»“æ„ã€‚è¿™ä¸ªå³è¯¥è¡¨çš„ç´¢å¼•æ ‘ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®åº“è¡¨ç”Ÿæ¥å°±æ˜¯ä¸€é¢—å¸¦æœ‰æ•°æ®çš„ç´¢å¼•æ ‘ï¼Œæ•°æ®å‡å­˜å‚¨åœ¨å¶å­èŠ‚ç‚¹ã€‚å¤šè¾¾10+çš„åˆ†å‰æ ‘ç»“æ„ï¼ŒæŠŠå¤§æ•°æ®é‡æœç´¢æ‰€éœ€çš„æŸ¥è¯¢æ¬¡æ•°æŒ‡æ•°çº§çš„å‡å°‘ï¼Œæå¤§åœ°é™ä½äº†ioæ¶ˆè€—ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p></li></ol><p><img src="https://pic2.zhimg.com/50/v2-ccc619303bf1ade411ea903f5e392941_hd.jpg" alt="â€œsql èšé›†ç´¢å¼•æ ‘â€çš„å›¾ç‰‡æœç´¢ç»“æœ&quot;"></p><ol start="2"><li><p>éèšé›†ç´¢å¼•</p><p> å½“æˆ‘ä»¬ç»™æ•°æ®åº“è¡¨å¢åŠ æ™®é€šç´¢å¼•ã€å”¯ä¸€ç´¢å¼•æ—¶ï¼Œè¿™æ—¶æ•°æ®åº“ä¼šä»æºè¡¨æ•°æ®å¤åˆ¶å‡ºç›¸åº”çš„åˆ—æ•°æ®å‡ºæ¥ï¼Œç„¶åæ„é€ æˆä¸€é¢—å¤šå‰æ ‘ã€‚åŒæ ·ï¼Œå½“åŒ¹é…æ¡ä»¶ä¸è¯¥ç´¢å¼•æ ‘åŒ¹é…æ—¶ï¼Œä¼šè¿…é€Ÿåœ¨å¶å­èŠ‚ç‚¹æ‰¾åˆ°ç›¸åº”çš„æ•°æ®ã€‚</p><p> ä¸ä¸€æ ·çš„æ˜¯ï¼Œè¿™é‡Œæ‰¾åˆ°çš„æ˜¯æ•°æ®çš„èšé›†ç´¢å¼•ï¼Œç„¶åæ•°æ®åº“æ ¹æ®ç°‡é›†ç´¢å¼•æ‰¾åˆ°å¯¹åº”çš„æ•°æ®ã€‚æ‰€ä»¥ï¼Œéèšé›†ç´¢å¼•çš„æŸ¥è¯¢æœ€ç»ˆè¿˜æ˜¯ä¼šæ£€ç´¢ä¸€éèšé›†ç´¢å¼•ã€‚</p><p><img src="https://pic1.zhimg.com/v2-ef9b5d5d6407d80b937ca19d6be9dadc_b.jpg" alt="â€œsql èšé›†ç´¢å¼•æ ‘â€çš„å›¾ç‰‡æœç´¢ç»“æœ&quot;"></p></li><li><p>è¦†ç›–ç´¢å¼•</p><p> æŸ¥è¯¢æ¡ä»¶å’Œè¿”å›ç»“æœç›´æ¥è¦†ç›–åœ¨æ‰€æŸ¥ç´¢å¼•æ ‘å†…æ—¶ï¼Œè¿™æ ·çš„ç´¢å¼•å«è¦†ç›–ç´¢å¼•ã€‚ä»–çš„è¡¨ç°ä¸ºå¤åˆç´¢å¼•ï¼Œåªä¸è¿‡ä»–ä¸éœ€è¦è¿›è¡Œå›è¡¨æ‰«æï¼Œæ‰€æœ‰çš„æ•°æ®å°±åœ¨ç´¢å¼•æ ‘å†…ã€‚</p>   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select name from user where birthday &gt; '2000-01-01'\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">     id: 1</span><br><span class="line">  select_type: SIMPLE</span><br><span class="line">        table: user</span><br><span class="line">         type: range</span><br><span class="line">possible_keys: idx_birth</span><br><span class="line">          key: idx_birth</span><br><span class="line">      key_len: 3</span><br><span class="line">          ref: NULL</span><br><span class="line">         rows: 15734</span><br><span class="line">        Extra: Using index condition</span><br><span class="line">1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>   Extra ä¸º Using index condition è¯´æ˜ä½¿ç”¨çš„æ£€ç´¢æ–¹å¼ä¸ºäºŒçº§æ£€ç´¢ï¼Œå³7999ä¸ªä¹¦ç­¾å€¼è¢«ç”¨æ¥è¿›è¡Œå›è¡¨æŸ¥è¯¢ã€‚</p><p>   è¿™å¥sqlé‡ŒæŸ¥è¯¢ç”¨åˆ°2ä¸ªå­—æ®µï¼Œåˆ›å»ºbirthdayå’Œnameçš„å¤åˆç´¢å¼•ï¼Œç„¶åå†æŸ¥è¯¢ã€‚</p>   <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; explain select name from user where birthday &gt; '2000-01-01' \G</span><br><span class="line">      *************************** 1. row ***************************</span><br><span class="line">                 id: 1</span><br><span class="line">        select_type: SIMPLE</span><br><span class="line">              table: user</span><br><span class="line">               type: range</span><br><span class="line">      possible_keys: idx_birth_name, idx_birth</span><br><span class="line">                key: idx_birth_name</span><br><span class="line">            key_len: 3</span><br><span class="line">                ref: NULL</span><br><span class="line">               rows: 1684</span><br><span class="line">              Extra: Using index</span><br><span class="line">      1 row in <span class="keyword">set</span> (<span class="number">0.00</span> sec)</span><br></pre></td></tr></table></figure><p>   Extraæç¤ºä¿¡æ¯ä¸ºUsing indexè€Œä¸æ˜¯Using index conditionï¼Œä»£è¡¨æ²¡æœ‰äº†å›è¡¨æŸ¥è¯¢çš„è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯å®ç°äº†ç´¢å¼•è¦†ç›–ã€‚</p></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ç´¢å¼•ç”Ÿæˆ&lt;/p&gt;
&lt;p&gt;ç´¢å¼•ä¸ç´¢å¼•ç›´æ¥å¹¶æ— ç›´æ¥å…³è”ï¼Œä»–ä»¬æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;p&gt;èšé›†ç´¢å¼•&lt;/p&gt;
&lt;p&gt; å½“æˆ‘ä»¬ç»™ä¸€ä¸ªæ•°æ®åº“è¡¨åˆ†é…ä¸€ä¸ªä¸»é”®æ—¶ï¼Œè¿™æ—¶å°±ä¼šç”Ÿæˆä¸€æ£µå¹³è¡¡æ ‘ç»“æ„ã€‚è¿™ä¸ªå³è¯¥è¡¨çš„ç´¢å¼•æ ‘ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®åº“è¡¨ç”Ÿæ¥å°±æ˜¯ä¸€é¢—å¸¦æœ‰æ•°æ®çš„ç´¢å¼•æ ‘ï¼Œæ•°æ®å‡å­˜å‚¨åœ¨
      
    
    </summary>
    
    
      <category term="database" scheme="http://www.zzzhy.cn/categories/database/"/>
    
    
      <category term="database" scheme="http://www.zzzhy.cn/tags/database/"/>
    
      <category term="sql" scheme="http://www.zzzhy.cn/tags/sql/"/>
    
  </entry>
  
  <entry>
    <title>nginxç¼–è¯‘å‚æ•°</title>
    <link href="http://www.zzzhy.cn/2019/10/30/nginx-compile-opts/"/>
    <id>http://www.zzzhy.cn/2019/10/30/nginx-compile-opts/</id>
    <published>2019-10-29T17:39:52.000Z</published>
    <updated>2019-11-14T16:30:02.660Z</updated>
    
    <content type="html"><![CDATA[<h1 id="nginxå‚æ•°ï¼š"><a href="#nginxå‚æ•°ï¼š" class="headerlink" title="nginxå‚æ•°ï¼š"></a>nginxå‚æ•°ï¼š</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">â€“prefix= æŒ‡å‘å®‰è£…ç›®å½•</span><br><span class="line">â€“sbin-path æŒ‡å‘ï¼ˆæ‰§è¡Œï¼‰ç¨‹åºæ–‡ä»¶ï¼ˆnginxï¼‰</span><br><span class="line">â€“conf-path= æŒ‡å‘é…ç½®æ–‡ä»¶ï¼ˆnginx.confï¼‰</span><br><span class="line">â€“error-log-path= æŒ‡å‘é”™è¯¯æ—¥å¿—ç›®å½•</span><br><span class="line">â€“pid-path= æŒ‡å‘pidæ–‡ä»¶ï¼ˆnginx.pidï¼‰</span><br><span class="line">â€“lock-path= æŒ‡å‘lockæ–‡ä»¶ï¼ˆnginx.lockï¼‰ï¼ˆå®‰è£…æ–‡ä»¶é”å®šï¼Œé˜²æ­¢å®‰è£…æ–‡ä»¶è¢«åˆ«äººåˆ©ç”¨ï¼Œæˆ–è‡ªå·±è¯¯æ“ä½œã€‚ï¼‰</span><br><span class="line">â€“user= æŒ‡å®šç¨‹åºè¿è¡Œæ—¶çš„éç‰¹æƒç”¨æˆ·</span><br><span class="line">â€“group= æŒ‡å®šç¨‹åºè¿è¡Œæ—¶çš„éç‰¹æƒç”¨æˆ·ç»„</span><br><span class="line">â€“builddir= æŒ‡å‘ç¼–è¯‘ç›®å½•</span><br><span class="line">â€“with-rtsig_module å¯ç”¨rtsigæ¨¡å—æ”¯æŒï¼ˆå®æ—¶ä¿¡å·ï¼‰</span><br><span class="line">â€“with-select_module å¯ç”¨selectæ¨¡å—æ”¯æŒï¼ˆä¸€ç§è½®è¯¢æ¨¡å¼,ä¸æ¨èåœ¨é«˜è½½ç¯å¢ƒä¸‹ä½¿ç”¨ï¼‰ç¦ç”¨ï¼šâ€“without-select_module</span><br><span class="line">â€“with-poll_module å¯ç”¨pollæ¨¡å—æ”¯æŒï¼ˆåŠŸèƒ½ä¸selectç›¸åŒï¼Œä¸selectç‰¹æ€§ç›¸åŒï¼Œä¸ºä¸€ç§è½®è¯¢æ¨¡å¼,ä¸æ¨èåœ¨é«˜è½½ç¯å¢ƒä¸‹ä½¿ç”¨ï¼‰</span><br><span class="line">â€“with-file-aio å¯ç”¨file aioæ”¯æŒï¼ˆä¸€ç§APLæ–‡ä»¶ä¼ è¾“æ ¼å¼ï¼‰</span><br><span class="line">â€“with-ipv6 å¯ç”¨ipv6æ”¯æŒ</span><br><span class="line">â€“with-http_ssl_module å¯ç”¨ngx_http_ssl_moduleæ”¯æŒï¼ˆä½¿æ”¯æŒhttpsè¯·æ±‚ï¼Œéœ€å·²å®‰è£…opensslï¼‰</span><br><span class="line">â€“with-http_realip_module å¯ç”¨ngx_http_realip_moduleæ”¯æŒï¼ˆè¿™ä¸ªæ¨¡å—å…è®¸ä»è¯·æ±‚æ ‡å¤´æ›´æ”¹å®¢æˆ·ç«¯çš„IPåœ°å€å€¼ï¼Œé»˜è®¤ä¸ºå…³ï¼‰</span><br><span class="line">â€“with-http_addition_module å¯ç”¨ngx_http_addition_moduleæ”¯æŒï¼ˆä½œä¸ºä¸€ä¸ªè¾“å‡ºè¿‡æ»¤å™¨ï¼Œæ”¯æŒä¸å®Œå…¨ç¼“å†²ï¼Œåˆ†éƒ¨åˆ†å“åº”è¯·æ±‚ï¼‰</span><br><span class="line">â€“with-http_xslt_module å¯ç”¨ngx_http_xslt_moduleæ”¯æŒï¼ˆè¿‡æ»¤è½¬æ¢XMLè¯·æ±‚ï¼‰</span><br><span class="line">â€“with-http_image_filter_module å¯ç”¨ngx_http_image_filter_moduleæ”¯æŒï¼ˆä¼ è¾“JPEG/GIF/PNG å›¾ç‰‡çš„ä¸€ä¸ªè¿‡æ»¤å™¨ï¼‰ï¼ˆé»˜è®¤ä¸ºä¸å¯ç”¨ã€‚gdåº“è¦ç”¨åˆ°ï¼‰</span><br><span class="line">â€“with-http_geoip_module å¯ç”¨ngx_http_geoip_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—åˆ›å»ºåŸºäºä¸MaxMind GeoIPäºŒè¿›åˆ¶æ–‡ä»¶ç›¸é…çš„å®¢æˆ·ç«¯IPåœ°å€çš„ngx_http_geoip_moduleå˜é‡ï¼‰</span><br><span class="line">â€“with-http_sub_module å¯ç”¨ngx_http_sub_moduleæ”¯æŒï¼ˆå…è®¸ç”¨ä¸€äº›å…¶ä»–æ–‡æœ¬æ›¿æ¢nginxå“åº”ä¸­çš„ä¸€äº›æ–‡æœ¬ï¼‰</span><br><span class="line">â€“with-http_dav_module å¯ç”¨ngx_http_dav_moduleæ”¯æŒï¼ˆå¢åŠ PUT,DELETE,MKCOLï¼šåˆ›å»ºé›†åˆ,COPYå’ŒMOVEæ–¹æ³•ï¼‰é»˜è®¤æƒ…å†µä¸‹ä¸ºå…³é—­ï¼Œéœ€ç¼–è¯‘å¼€å¯</span><br><span class="line">â€“with-http_flv_module å¯ç”¨ngx_http_flv_moduleæ”¯æŒï¼ˆæä¾›å¯»æ±‚å†…å­˜ä½¿ç”¨åŸºäºæ—¶é—´çš„åç§»é‡æ–‡ä»¶ï¼‰</span><br><span class="line">â€“with-http_gzip_static_module å¯ç”¨ngx_http_gzip_static_moduleæ”¯æŒï¼ˆåœ¨çº¿å®æ—¶å‹ç¼©è¾“å‡ºæ•°æ®æµï¼‰</span><br><span class="line">â€“with-http_random_index_module å¯ç”¨ngx_http_random_index_moduleæ”¯æŒï¼ˆä»ç›®å½•ä¸­éšæœºæŒ‘é€‰ä¸€ä¸ªç›®å½•ç´¢å¼•ï¼‰</span><br><span class="line">â€“with-http_secure_link_module å¯ç”¨ngx_http_secure_link_moduleæ”¯æŒï¼ˆè®¡ç®—å’Œæ£€æŸ¥è¦æ±‚æ‰€éœ€çš„å®‰å…¨é“¾æ¥ç½‘å€ï¼‰</span><br><span class="line">â€“with-http_degradation_module Â å¯ç”¨ngx_http_degradation_moduleæ”¯æŒï¼ˆå…è®¸åœ¨å†…å­˜ä¸è¶³çš„æƒ…å†µä¸‹è¿”å›204æˆ–444ç ï¼‰</span><br><span class="line">â€“with-http_stub_status_module å¯ç”¨ngx_http_stub_status_moduleæ”¯æŒï¼ˆè·å–nginxè‡ªä¸Šæ¬¡å¯åŠ¨ä»¥æ¥çš„å·¥ä½œçŠ¶æ€ï¼‰</span><br><span class="line">â€“without-http_charset_module ç¦ç”¨ngx_http_charset_moduleæ”¯æŒï¼ˆé‡æ–°ç¼–ç webé¡µé¢ï¼Œä½†åªèƒ½æ˜¯ä¸€ä¸ªæ–¹å‘â€“æœåŠ¡å™¨ç«¯åˆ°å®¢æˆ·ç«¯ï¼Œå¹¶ä¸”åªæœ‰ä¸€ä¸ªå­—èŠ‚çš„ç¼–ç å¯ä»¥è¢«é‡æ–°ç¼–ç ï¼‰</span><br><span class="line">â€“without-http_gzip_module ç¦ç”¨ngx_http_gzip_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—åŒ-with-http_gzip_static_moduleåŠŸèƒ½ä¸€æ ·ï¼‰</span><br><span class="line">â€“without-http_ssi_module ç¦ç”¨ngx_http_ssi_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—æä¾›äº†ä¸€ä¸ªåœ¨è¾“å…¥ç«¯å¤„ç†å¤„ç†æœåŠ¡å™¨åŒ…å«æ–‡ä»¶ï¼ˆSSIï¼‰çš„è¿‡æ»¤å™¨ï¼Œç›®å‰æ”¯æŒSSIå‘½ä»¤çš„åˆ—è¡¨æ˜¯ä¸å®Œæ•´çš„ï¼‰</span><br><span class="line">â€“without-http_userid_module ç¦ç”¨ngx_http_userid_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—ç”¨æ¥å¤„ç†ç”¨æ¥ç¡®å®šå®¢æˆ·ç«¯åç»­è¯·æ±‚çš„cookiesï¼‰</span><br><span class="line">â€“without-http_access_module ç¦ç”¨ngx_http_access_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—æä¾›äº†ä¸€ä¸ªç®€å•çš„åŸºäºä¸»æœºçš„è®¿é—®æ§åˆ¶ã€‚å…è®¸/æ‹’ç»åŸºäºipåœ°å€ï¼‰</span><br><span class="line">â€“without-http_auth_basic_moduleç¦ç”¨ngx_http_auth_basic_moduleï¼ˆè¯¥æ¨¡å—æ˜¯å¯ä»¥ä½¿ç”¨ç”¨æˆ·åå’Œå¯†ç åŸºäºhttpåŸºæœ¬è®¤è¯æ–¹æ³•æ¥ä¿æŠ¤ä½ çš„ç«™ç‚¹æˆ–å…¶éƒ¨åˆ†å†…å®¹ï¼‰</span><br><span class="line">â€“without-http_autoindex_module ç¦ç”¨<span class="built_in">disable</span> ngx_http_autoindex_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—ç”¨äºè‡ªåŠ¨ç”Ÿæˆç›®å½•åˆ—è¡¨ï¼Œåªåœ¨ngx_http_index_moduleæ¨¡å—æœªæ‰¾åˆ°ç´¢å¼•æ–‡ä»¶æ—¶å‘å‡ºè¯·æ±‚ã€‚ï¼‰</span><br><span class="line">â€“without-http_geo_module ç¦ç”¨ngx_http_geo_moduleæ”¯æŒï¼ˆåˆ›å»ºä¸€äº›å˜é‡ï¼Œå…¶å€¼ä¾èµ–äºå®¢æˆ·ç«¯çš„IPåœ°å€ï¼‰</span><br><span class="line">â€“without-http_map_module ç¦ç”¨ngx_http_map_moduleæ”¯æŒï¼ˆä½¿ç”¨ä»»æ„çš„é”®/å€¼å¯¹è®¾ç½®é…ç½®å˜é‡ï¼‰</span><br><span class="line">â€“without-http_split_clients_module ç¦ç”¨ngx_http_split_clients_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—ç”¨æ¥åŸºäºæŸäº›æ¡ä»¶åˆ’åˆ†ç”¨æˆ·ã€‚æ¡ä»¶å¦‚ï¼šipåœ°å€ã€æŠ¥å¤´ã€cookiesç­‰ç­‰ï¼‰</span><br><span class="line">â€“without-http_referer_module ç¦ç”¨<span class="built_in">disable</span> ngx_http_referer_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—ç”¨æ¥è¿‡æ»¤è¯·æ±‚ï¼Œæ‹’ç»æŠ¥å¤´ä¸­Refererå€¼ä¸æ­£ç¡®çš„è¯·æ±‚ï¼‰</span><br><span class="line">â€“without-http_rewrite_module ç¦ç”¨ngx_http_rewrite_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—å…è®¸ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æ”¹å˜URIï¼Œå¹¶ä¸”æ ¹æ®å˜é‡æ¥è½¬å‘ä»¥åŠé€‰æ‹©é…ç½®ã€‚å¦‚æœåœ¨serverçº§åˆ«è®¾ç½®è¯¥é€‰é¡¹ï¼Œé‚£ä¹ˆä»–ä»¬å°†åœ¨ locationä¹‹å‰ç”Ÿæ•ˆã€‚å¦‚æœåœ¨locationè¿˜æœ‰æ›´è¿›ä¸€æ­¥çš„é‡å†™è§„åˆ™ï¼Œlocationéƒ¨åˆ†çš„è§„åˆ™ä¾ç„¶ä¼šè¢«æ‰§è¡Œã€‚å¦‚æœè¿™ä¸ªURIé‡å†™æ˜¯å› ä¸ºlocationéƒ¨åˆ†çš„è§„åˆ™é€ æˆçš„ï¼Œé‚£ä¹ˆ locationéƒ¨åˆ†ä¼šå†æ¬¡è¢«æ‰§è¡Œä½œä¸ºæ–°çš„URIã€‚ è¿™ä¸ªå¾ªç¯ä¼šæ‰§è¡Œ10æ¬¡ï¼Œç„¶åNginxä¼šè¿”å›ä¸€ä¸ª500é”™è¯¯ã€‚ï¼‰</span><br><span class="line">â€“without-http_proxy_module ç¦ç”¨ngx_http_proxy_moduleæ”¯æŒï¼ˆæœ‰å…³ä»£ç†æœåŠ¡å™¨ï¼‰</span><br><span class="line">â€“without-http_fastcgi_module ç¦ç”¨ngx_http_fastcgi_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—å…è®¸Nginx ä¸FastCGI è¿›ç¨‹äº¤äº’ï¼Œå¹¶é€šè¿‡ä¼ é€’å‚æ•°æ¥æ§åˆ¶FastCGI è¿›ç¨‹å·¥ä½œã€‚ ï¼‰FastCGIä¸€ä¸ªå¸¸é©»å‹çš„å…¬å…±ç½‘å…³æ¥å£ã€‚</span><br><span class="line">â€“without-http_uwsgi_module ç¦ç”¨ngx_http_uwsgi_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—ç”¨æ¥åŒ»ç”¨uwsgiåè®®ï¼ŒuWSGIæœåŠ¡å™¨ç›¸å…³ï¼‰</span><br><span class="line">â€“without-http_scgi_module ç¦ç”¨ngx_http_scgi_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—ç”¨æ¥å¯ç”¨SCGIåè®®æ”¯æŒï¼ŒSCGIåè®®æ˜¯CGIåè®®çš„æ›¿ä»£ã€‚å®ƒæ˜¯ä¸€ç§åº”ç”¨ç¨‹åºä¸HTTPæœåŠ¡æ¥å£æ ‡å‡†ã€‚å®ƒæœ‰äº›åƒFastCGIä½†ä»–çš„è®¾è®¡ æ›´å®¹æ˜“å®ç°ã€‚ï¼‰</span><br><span class="line">â€“without-http_memcached_module ç¦ç”¨ngx_http_memcached_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—ç”¨æ¥æä¾›ç®€å•çš„ç¼“å­˜ï¼Œä»¥æé«˜ç³»ç»Ÿæ•ˆç‡ï¼‰</span><br><span class="line">-without-http_limit_zone_module ç¦ç”¨ngx_http_limit_zone_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—å¯ä»¥é’ˆå¯¹æ¡ä»¶ï¼Œè¿›è¡Œä¼šè¯çš„å¹¶å‘è¿æ¥æ•°æ§åˆ¶ï¼‰</span><br><span class="line">â€“without-http_limit_req_module ç¦ç”¨ngx_http_limit_req_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—å…è®¸ä½ å¯¹äºä¸€ä¸ªåœ°å€è¿›è¡Œè¯·æ±‚æ•°é‡çš„é™åˆ¶ç”¨ä¸€ä¸ªç»™å®šçš„sessionæˆ–ä¸€ä¸ªç‰¹å®šçš„äº‹ä»¶ï¼‰</span><br><span class="line">â€“without-http_empty_gif_module ç¦ç”¨ngx_http_empty_gif_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—åœ¨å†…å­˜ä¸­å¸¸é©»äº†ä¸€ä¸ª1*1çš„é€æ˜GIFå›¾åƒï¼Œå¯ä»¥è¢«éå¸¸å¿«é€Ÿçš„è°ƒç”¨ï¼‰</span><br><span class="line">â€“without-http_browser_module ç¦ç”¨ngx_http_browser_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—ç”¨æ¥åˆ›å»ºä¾èµ–äºè¯·æ±‚æŠ¥å¤´çš„å€¼ã€‚å¦‚æœæµè§ˆå™¨ä¸ºmodern ï¼Œåˆ™<span class="variable">$modern_browser</span>ç­‰äºmodern_browser_valueæŒ‡ä»¤åˆ†é…çš„å€¼ï¼›å¦‚ æœæµè§ˆå™¨ä¸ºoldï¼Œåˆ™<span class="variable">$ancient_browser</span>ç­‰äº ancient_browser_valueæŒ‡ä»¤åˆ†é…çš„å€¼ï¼›å¦‚æœæµè§ˆå™¨ä¸º MSIEä¸­çš„ä»»æ„ç‰ˆæœ¬ï¼Œåˆ™ <span class="variable">$msie</span>ç­‰äº1ï¼‰</span><br><span class="line">â€“without-http_upstream_ip_hash_module ç¦ç”¨ngx_http_upstream_ip_hash_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—ç”¨äºç®€å•çš„è´Ÿè½½å‡è¡¡ï¼‰</span><br><span class="line">â€“with-http_perl_module å¯ç”¨ngx_http_perl_moduleæ”¯æŒï¼ˆè¯¥æ¨¡å—ä½¿nginxå¯ä»¥ç›´æ¥ä½¿ç”¨perlæˆ–é€šè¿‡ssiè°ƒç”¨perlï¼‰</span><br><span class="line">â€“with-perl_modules_path= è®¾å®šperlæ¨¡å—è·¯å¾„</span><br><span class="line">â€“with-perl= è®¾å®šperlåº“æ–‡ä»¶è·¯å¾„</span><br><span class="line">â€“http-log-path= è®¾å®šaccess <span class="built_in">log</span>è·¯å¾„</span><br><span class="line">â€“http-client-body-temp-path= è®¾å®šhttpå®¢æˆ·ç«¯è¯·æ±‚ä¸´æ—¶æ–‡ä»¶è·¯å¾„</span><br><span class="line">â€“http-proxy-temp-path= è®¾å®šhttpä»£ç†ä¸´æ—¶æ–‡ä»¶è·¯å¾„</span><br><span class="line">â€“http-fastcgi-temp-path= è®¾å®šhttp fastcgiä¸´æ—¶æ–‡ä»¶è·¯å¾„</span><br><span class="line">â€“http-uwsgi-temp-path= è®¾å®šhttp uwsgiä¸´æ—¶æ–‡ä»¶è·¯å¾„</span><br><span class="line">â€“http-scgi-temp-path= è®¾å®šhttp scgiä¸´æ—¶æ–‡ä»¶è·¯å¾„</span><br><span class="line">-without-http ç¦ç”¨http serveråŠŸèƒ½</span><br><span class="line">â€“without-http-cache ç¦ç”¨http cacheåŠŸèƒ½</span><br><span class="line">â€“with-mail å¯ç”¨POP3/IMAP4/SMTPä»£ç†æ¨¡å—æ”¯æŒ</span><br><span class="line">â€“with-mail_ssl_module å¯ç”¨ngx_mail_ssl_moduleæ”¯æŒ</span><br><span class="line">â€“without-mail_pop3_module ç¦ç”¨pop3åè®®ï¼ˆPOP3å³é‚®å±€åè®®çš„ç¬¬3ä¸ªç‰ˆæœ¬,å®ƒæ˜¯è§„å®šä¸ªäººè®¡ç®—æœºå¦‚ä½•è¿æ¥åˆ°äº’è”ç½‘ä¸Šçš„é‚®ä»¶æœåŠ¡å™¨è¿›è¡Œæ”¶å‘é‚®ä»¶çš„åè®®ã€‚æ˜¯å› ç‰¹ç½‘ç”µå­é‚®ä»¶çš„ç¬¬ä¸€ä¸ªç¦»çº¿åè®®æ ‡ å‡†,POP3åè®®å…è®¸ç”¨æˆ·ä»æœåŠ¡å™¨ä¸ŠæŠŠé‚®ä»¶å­˜å‚¨åˆ°æœ¬åœ°ä¸»æœºä¸Š,åŒæ—¶æ ¹æ®å®¢æˆ·ç«¯çš„æ“ä½œåˆ é™¤æˆ–ä¿å­˜åœ¨é‚®ä»¶æœåŠ¡å™¨ä¸Šçš„é‚®ä»¶ã€‚POP3åè®®æ˜¯TCP/IPåè®®æ—ä¸­çš„ä¸€å‘˜ï¼Œä¸»è¦ç”¨äº æ”¯æŒä½¿ç”¨å®¢æˆ·ç«¯è¿œç¨‹ç®¡ç†åœ¨æœåŠ¡å™¨ä¸Šçš„ç”µå­é‚®ä»¶ï¼‰</span><br><span class="line">â€“without-mail_imap_module ç¦ç”¨imapåè®®ï¼ˆä¸€ç§é‚®ä»¶è·å–åè®®ã€‚å®ƒçš„ä¸»è¦ä½œç”¨æ˜¯é‚®ä»¶å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡è¿™ç§åè®®ä»é‚®ä»¶æœåŠ¡å™¨ä¸Šè·å–é‚®ä»¶çš„ä¿¡æ¯ï¼Œä¸‹è½½é‚®ä»¶ç­‰ã€‚IMAPåè®®è¿è¡Œåœ¨TCP/IPåè®®ä¹‹ä¸Šï¼Œ ä½¿ç”¨çš„ç«¯å£æ˜¯143ã€‚å®ƒä¸POP3åè®®çš„ä¸»è¦åŒºåˆ«æ˜¯ç”¨æˆ·å¯ä»¥ä¸ç”¨æŠŠæ‰€æœ‰çš„é‚®ä»¶å…¨éƒ¨ä¸‹è½½ï¼Œå¯ä»¥é€šè¿‡å®¢æˆ·ç«¯ç›´æ¥å¯¹æœåŠ¡å™¨ä¸Šçš„é‚®ä»¶è¿›è¡Œæ“ä½œã€‚ï¼‰</span><br><span class="line">â€“without-mail_smtp_module ç¦ç”¨smtpåè®®ï¼ˆSMTPå³ç®€å•é‚®ä»¶ä¼ è¾“åè®®,å®ƒæ˜¯ä¸€ç»„ç”¨äºç”±æºåœ°å€åˆ°ç›®çš„åœ°å€ä¼ é€é‚®ä»¶çš„è§„åˆ™ï¼Œç”±å®ƒæ¥æ§åˆ¶ä¿¡ä»¶çš„ä¸­è½¬æ–¹å¼ã€‚SMTPåè®®å±äºTCP/IPåè®®æ—ï¼Œå®ƒå¸®åŠ©æ¯å°è®¡ç®—æœºåœ¨å‘é€æˆ–ä¸­è½¬ä¿¡ä»¶æ—¶æ‰¾åˆ°ä¸‹ä¸€ä¸ªç›®çš„åœ°ã€‚ï¼‰</span><br><span class="line">â€“with-google_perftools_module å¯ç”¨ngx_google_perftools_moduleæ”¯æŒï¼ˆè°ƒè¯•ç”¨ï¼Œå‰–æç¨‹åºæ€§èƒ½ç“¶é¢ˆï¼‰</span><br><span class="line">â€“with-cpp_test_module å¯ç”¨ngx_cpp_test_moduleæ”¯æŒ</span><br><span class="line">â€“add-module= å¯ç”¨å¤–éƒ¨æ¨¡å—æ”¯æŒ</span><br><span class="line">â€“with-cc= æŒ‡å‘Cç¼–è¯‘å™¨è·¯å¾„</span><br><span class="line">â€“with-cpp= æŒ‡å‘Cé¢„å¤„ç†è·¯å¾„</span><br><span class="line">â€“with-cc-opt= è®¾ç½®Cç¼–è¯‘å™¨å‚æ•°ï¼ˆPCREåº“ï¼Œéœ€è¦æŒ‡å®šâ€“with-cc-opt=â€-I /usr/<span class="built_in">local</span>/includeâ€ï¼Œå¦‚æœä½¿ç”¨select()å‡½æ•°åˆ™éœ€è¦åŒæ—¶å¢åŠ æ–‡ä»¶æè¿°ç¬¦æ•°é‡ï¼Œå¯ä»¥é€šè¿‡â€“with-cc- opt=â€-D FD_SETSIZE=2048â€æŒ‡å®šã€‚ï¼‰</span><br><span class="line">â€“with-ld-opt= è®¾ç½®è¿æ¥æ–‡ä»¶å‚æ•°ã€‚ï¼ˆPCREåº“ï¼Œéœ€è¦æŒ‡å®šâ€“with-ld-opt=â€-L /usr/<span class="built_in">local</span>/libâ€ã€‚ï¼‰</span><br><span class="line">â€“with-cpu-opt= æŒ‡å®šç¼–è¯‘çš„CPUï¼Œå¯ç”¨çš„å€¼ä¸º: pentium, pentiumpro, pentium3, pentium4, athlon, opteron, amd64, sparc32, sparc64, ppc64</span><br><span class="line">â€“without-pcre ç¦ç”¨pcreåº“</span><br><span class="line">â€“with-pcre å¯ç”¨pcreåº“</span><br><span class="line">â€“with-pcre= æŒ‡å‘pcreåº“æ–‡ä»¶ç›®å½•</span><br><span class="line">â€“with-pcre-opt= åœ¨ç¼–è¯‘æ—¶ä¸ºpcreåº“è®¾ç½®é™„åŠ å‚æ•°</span><br><span class="line">â€“with-md5= æŒ‡å‘md5åº“æ–‡ä»¶ç›®å½•ï¼ˆæ¶ˆæ¯æ‘˜è¦ç®—æ³•ç¬¬äº”ç‰ˆï¼Œç”¨ä»¥æä¾›æ¶ˆæ¯çš„å®Œæ•´æ€§ä¿æŠ¤ï¼‰</span><br><span class="line">â€“with-md5-opt= åœ¨ç¼–è¯‘æ—¶ä¸ºmd5åº“è®¾ç½®é™„åŠ å‚æ•°</span><br><span class="line">â€“with-md5-asm ä½¿ç”¨md5æ±‡ç¼–æº</span><br><span class="line">â€“with-sha1= æŒ‡å‘sha1åº“ç›®å½•ï¼ˆæ•°å­—ç­¾åç®—æ³•ï¼Œä¸»è¦ç”¨äºæ•°å­—ç­¾åï¼‰</span><br><span class="line">â€“with-sha1-opt= åœ¨ç¼–è¯‘æ—¶ä¸ºsha1åº“è®¾ç½®é™„åŠ å‚æ•°</span><br><span class="line">â€“with-sha1-asm ä½¿ç”¨sha1æ±‡ç¼–æº</span><br><span class="line">â€“with-zlib= æŒ‡å‘zlibåº“ç›®å½•</span><br><span class="line">â€“with-zlib-opt= åœ¨ç¼–è¯‘æ—¶ä¸ºzlibè®¾ç½®é™„åŠ å‚æ•°</span><br><span class="line">â€“with-zlib-asm= ä¸ºæŒ‡å®šçš„CPUä½¿ç”¨zlibæ±‡ç¼–æºè¿›è¡Œä¼˜åŒ–ï¼ŒCPUç±»å‹ä¸ºpentium, pentiumpro</span><br><span class="line">â€“with-libatomic ä¸ºåŸå­å†…å­˜çš„æ›´æ–°æ“ä½œçš„å®ç°æä¾›ä¸€ä¸ªæ¶æ„</span><br><span class="line">â€“with-libatomic= æŒ‡å‘libatomic_opså®‰è£…ç›®å½•</span><br><span class="line">â€“with-openssl= æŒ‡å‘opensslå®‰è£…ç›®å½•</span><br><span class="line">â€“with-openssl-opt åœ¨ç¼–è¯‘æ—¶ä¸ºopensslè®¾ç½®é™„åŠ å‚æ•°</span><br><span class="line">â€“with-debug å¯ç”¨debugæ—¥å¿—</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;nginxå‚æ•°ï¼š&quot;&gt;&lt;a href=&quot;#nginxå‚æ•°ï¼š&quot; class=&quot;headerlink&quot; title=&quot;nginxå‚æ•°ï¼š&quot;&gt;&lt;/a&gt;nginxå‚æ•°ï¼š&lt;/h1&gt;&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td cla
      
    
    </summary>
    
    
      <category term="nginx" scheme="http://www.zzzhy.cn/categories/nginx/"/>
    
    
      <category term="nginx" scheme="http://www.zzzhy.cn/tags/nginx/"/>
    
  </entry>
  
  <entry>
    <title>sql tuning</title>
    <link href="http://www.zzzhy.cn/2019/10/30/sql-tuning/"/>
    <id>http://www.zzzhy.cn/2019/10/30/sql-tuning/</id>
    <published>2019-10-29T17:20:51.000Z</published>
    <updated>2019-11-14T16:32:24.018Z</updated>
    
    <content type="html"><![CDATA[<h3 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h3><ol><li>å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œåº”å°½é‡é¿å…å…¨è¡¨æ‰«æï¼Œé¦–å…ˆåº”è€ƒè™‘åœ¨ where åŠ order by æ¶‰åŠçš„åˆ—ä¸Šå»ºç«‹ç´¢å¼•ã€‚</li><li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œ null å€¼åˆ¤æ–­ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œ<br>Sql ä»£ç  : select id from t where num is null;<br>å¯ä»¥åœ¨ num ä¸Šè®¾ç½®é»˜è®¤å€¼ 0,ç¡®ä¿è¡¨ä¸­ num åˆ—æ²¡æœ‰ null å€¼ï¼Œç„¶åè¿™æ ·æŸ¥è¯¢ï¼š<br>Sql ä»£ç  : select id from t where num=0;</li><li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨!=æˆ–&lt;&gt;æ“ä½œç¬¦ï¼Œå¦åˆ™å°†å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚</li><li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­ä½¿ç”¨ or æ¥è¿æ¥æ¡ä»¶ï¼Œå¦åˆ™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æï¼Œ<br>Sql ä»£ç  : select id from t where num=10 or num=20;<br>å¯ä»¥è¿™æ ·æŸ¥è¯¢ï¼š<br>Sql ä»£ç  : select id from t where num=10 union all select id from t where num=20;</li><li>in å’Œ not in ä¹Ÿè¦æ…ç”¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´å…¨è¡¨æ‰«æï¼Œå¦‚ï¼š<br>Sql ä»£ç  : select id from t where num in(1,2,3);<br>å¯¹äºè¿ç»­çš„æ•°å€¼ï¼Œèƒ½ç”¨ between å°±ä¸è¦ç”¨ in äº†ï¼š<br>Sql ä»£ç  : select id from t where num between 1 and 3;</li><li>ä¸‹é¢çš„æŸ¥è¯¢ä¹Ÿå°†å¯¼è‡´å…¨è¡¨æ‰«æï¼š<br>Sql ä»£ç  : select id from t where name like â€˜%c%â€™;<br>è‹¥è¦æé«˜æ•ˆç‡ï¼Œå¯ä»¥è€ƒè™‘å…¨æ–‡æ£€ç´¢ã€‚</li><li>å¦‚æœåœ¨ where å­å¥ä¸­ä½¿ç”¨å‚æ•°ï¼Œä¹Ÿä¼šå¯¼è‡´å…¨è¡¨æ‰«æã€‚å› ä¸º SQL åªæœ‰åœ¨è¿è¡Œæ—¶æ‰ä¼šè§£æå±€éƒ¨å˜é‡ï¼Œä½†ä¼˜ åŒ–ç¨‹åºä¸èƒ½å°†è®¿é—®è®¡åˆ’çš„é€‰æ‹©æ¨è¿Ÿåˆ°è¿è¡Œæ—¶;å®ƒå¿…é¡»åœ¨ç¼–è¯‘æ—¶è¿›è¡Œé€‰æ‹©ã€‚ç„¶ è€Œï¼Œå¦‚æœåœ¨ç¼–è¯‘æ—¶å»ºç«‹è®¿é—®è®¡ åˆ’ï¼Œå˜é‡çš„å€¼è¿˜æ˜¯æœªçŸ¥çš„ï¼Œå› è€Œæ— æ³•ä½œä¸ºç´¢å¼•é€‰æ‹©çš„è¾“å…¥é¡¹ã€‚å¦‚ä¸‹é¢è¯­å¥å°†è¿›è¡Œå…¨è¡¨æ‰«æï¼š<br>Sql ä»£ç  : select id from t where num=@num ;<br>å¯ä»¥æ”¹ä¸ºå¼ºåˆ¶æŸ¥è¯¢ä½¿ç”¨ç´¢å¼•ï¼š<br>Sql ä»£ç  : select id from t with(index(ç´¢å¼•å)) where num=@num ;</li><li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œè¡¨è¾¾å¼æ“ä½œï¼Œ è¿™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚<br>Sql ä»£ç  : select id from t where num/2=100;<br>å¯ä»¥è¿™æ ·æŸ¥è¯¢ï¼š<br>Sql ä»£ç  : select id from t where num=100*2;</li><li>åº”å°½é‡é¿å…åœ¨ where å­å¥ä¸­å¯¹å­—æ®µè¿›è¡Œå‡½æ•°æ“ä½œï¼Œè¿™å°†å¯¼è‡´å¼•æ“æ”¾å¼ƒä½¿ç”¨ç´¢å¼•è€Œè¿›è¡Œå…¨è¡¨æ‰«æã€‚å¦‚ï¼š<br>Sql ä»£ç  : select id from t where substring(name,1,3)=â€™abcâ€™;#name ä»¥ abc å¼€å¤´çš„ id<br>åº”æ”¹ä¸ºï¼š<br>Sql ä»£ç  : select id from t where name like â€˜abc%â€™;</li><li>ä¸è¦åœ¨ where å­å¥ä¸­çš„â€œ=â€å·¦è¾¹è¿›è¡Œå‡½æ•°ã€ç®—æœ¯è¿ç®—æˆ–å…¶ä»–è¡¨è¾¾å¼è¿ç®—ï¼Œå¦åˆ™ç³»ç»Ÿå°†å¯èƒ½æ— æ³•æ­£ç¡®ä½¿ç”¨ ç´¢å¼•ã€‚</li><li>åœ¨ä½¿ç”¨ç´¢å¼•å­—æ®µä½œä¸ºæ¡ä»¶æ—¶ï¼Œå¦‚æœè¯¥ç´¢å¼•æ˜¯å¤åˆç´¢å¼•ï¼Œé‚£ä¹ˆå¿…é¡»ä½¿ç”¨åˆ°è¯¥ç´¢å¼•ä¸­çš„ç¬¬ä¸€ä¸ªå­—æ®µä½œä¸ºæ¡ä»¶ æ—¶æ‰èƒ½ä¿è¯ç³»ç»Ÿä½¿ç”¨è¯¥ç´¢å¼•ï¼Œ å¦åˆ™è¯¥ç´¢å¼•å°†ä¸ä¼š è¢«ä½¿ç”¨ï¼Œ å¹¶ä¸”åº”å°½å¯èƒ½çš„è®©å­—æ®µé¡ºåºä¸ç´¢å¼•é¡ºåºç›¸ä¸€è‡´ã€‚</li><li>ä¸è¦å†™ä¸€äº›æ²¡æœ‰æ„ä¹‰çš„æŸ¥è¯¢ï¼Œå¦‚éœ€è¦ç”Ÿæˆä¸€ä¸ªç©ºè¡¨ç»“æ„ï¼š<br>Sql ä»£ç  : select col1,col2 into #t from t where 1=0;<br>è¿™ç±»ä»£ç ä¸ä¼šè¿”å›ä»»ä½•ç»“æœé›†ï¼Œä½†æ˜¯ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºçš„ï¼Œåº”æ”¹æˆè¿™æ ·ï¼š<br>Sql ä»£ç  : create table #t(â€¦);</li><li>å¾ˆå¤šæ—¶å€™ç”¨ exists ä»£æ›¿ in æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ï¼š<br>Sql ä»£ç  : select num from a where num in(select num from b);<br>ç”¨ä¸‹é¢çš„è¯­å¥æ›¿æ¢ï¼š<br>Sql ä»£ç  : select num from a where exists(select 1 from b where num=a.num);</li><li>å¹¶ä¸æ˜¯æ‰€æœ‰ç´¢å¼•å¯¹æŸ¥è¯¢éƒ½æœ‰æ•ˆï¼ŒSQL æ˜¯æ ¹æ®è¡¨ä¸­æ•°æ®æ¥è¿›è¡ŒæŸ¥è¯¢ä¼˜åŒ–çš„ï¼Œå½“ç´¢å¼•åˆ—æœ‰å¤§é‡æ•°æ®é‡å¤æ—¶ï¼Œ SQL æŸ¥è¯¢å¯èƒ½ä¸ä¼šå»åˆ©ç”¨ç´¢å¼•ï¼Œå¦‚ä¸€è¡¨ä¸­æœ‰å­—æ®µ <strong>*,maleã€female å‡ ä¹å„ä¸€åŠï¼Œé‚£ä¹ˆå³ä½¿åœ¨ *</strong> ä¸Šå»º äº†ç´¢å¼•ä¹Ÿå¯¹æŸ¥è¯¢æ•ˆç‡èµ·ä¸äº†ä½œç”¨ã€‚</li><li>ç´¢å¼•å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼Œç´¢å¼•å›ºç„¶å¯ä»¥æé«˜ç›¸åº”çš„ select çš„æ•ˆç‡ï¼Œä½†åŒæ—¶ä¹Ÿé™ä½äº† insert åŠ update çš„æ•ˆç‡ï¼Œå› ä¸º insert æˆ– update æ—¶æœ‰å¯èƒ½ä¼šé‡å»ºç´¢å¼•ï¼Œæ‰€ä»¥æ€æ ·å»ºç´¢å¼•éœ€è¦æ…é‡è€ƒè™‘ï¼Œè§†å…·ä½“æƒ…å†µè€Œå®šã€‚ä¸€ä¸ªè¡¨çš„ç´¢å¼•æ•°æœ€å¥½ä¸è¦è¶…è¿‡ 6 ä¸ªï¼Œè‹¥å¤ªå¤šåˆ™åº”è€ƒè™‘ä¸€äº›ä¸å¸¸ä½¿ç”¨åˆ°çš„åˆ—ä¸Šå»ºçš„ç´¢å¼•æ˜¯å¦æœ‰å¿…è¦ã€‚</li><li>åº”å°½å¯èƒ½çš„é¿å…æ›´æ–° clustered ç´¢å¼•æ•°æ®åˆ—ï¼Œ å› ä¸º clustered ç´¢å¼•æ•°æ®åˆ—çš„é¡ºåºå°±æ˜¯è¡¨è®°å½•çš„ç‰©ç†å­˜å‚¨é¡ºåºï¼Œä¸€æ—¦è¯¥åˆ—å€¼æ”¹å˜å°†å¯¼è‡´æ•´ä¸ªè¡¨è®°å½•çš„é¡ºåºçš„è°ƒæ•´ï¼Œä¼šè€—è´¹ç›¸å½“å¤§çš„èµ„æºã€‚è‹¥åº”ç”¨ç³»ç»Ÿéœ€è¦é¢‘ç¹æ›´æ–° clustered ç´¢å¼•æ•°æ®åˆ—ï¼Œé‚£ä¹ˆéœ€è¦è€ƒè™‘æ˜¯å¦åº”å°†è¯¥ç´¢å¼•å»ºä¸º clustered ç´¢å¼•ã€‚</li><li>å°½é‡ä½¿ç”¨æ•°å­—å‹å­—æ®µï¼Œè‹¥åªå«æ•°å€¼ä¿¡æ¯çš„å­—æ®µå°½é‡ä¸è¦è®¾è®¡ä¸ºå­—ç¬¦å‹ï¼Œè¿™ä¼šé™ä½æŸ¥è¯¢å’Œè¿æ¥çš„æ€§èƒ½ï¼Œå¹¶ ä¼šå¢åŠ å­˜å‚¨å¼€é”€ã€‚è¿™æ˜¯å› ä¸ºå¼•æ“åœ¨å¤„ç†æŸ¥è¯¢å’Œè¿æ¥æ—¶ä¼šé€ä¸ªæ¯”è¾ƒå­—ç¬¦ä¸²ä¸­æ¯ä¸€ä¸ªå­—ç¬¦ï¼Œè€Œå¯¹äºæ•°å­—å‹è€Œè¨€ åªéœ€è¦æ¯”è¾ƒä¸€æ¬¡å°±å¤Ÿäº†ã€‚</li><li>å°½å¯èƒ½çš„ä½¿ç”¨ varchar/nvarchar ä»£æ›¿ char/nchar , å› ä¸ºé¦–å…ˆå˜é•¿å­—æ®µå­˜å‚¨ç©ºé—´å°ï¼Œ å¯ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œ å…¶æ¬¡å¯¹äºæŸ¥è¯¢æ¥è¯´ï¼Œåœ¨ä¸€ä¸ªç›¸å¯¹è¾ƒå°çš„å­—æ®µå†…æœç´¢æ•ˆç‡æ˜¾ç„¶è¦é«˜äº›ã€‚</li><li>ä»»ä½•åœ°æ–¹éƒ½ä¸è¦ä½¿ç”¨ select * from t ,ç”¨å…·ä½“çš„å­—æ®µåˆ—è¡¨ä»£æ›¿â€œ*â€,ä¸è¦è¿”å›ç”¨ä¸åˆ°çš„ä»»ä½•å­—æ®µã€‚</li><li>å°½é‡ä½¿ç”¨è¡¨å˜é‡æ¥ä»£æ›¿ä¸´æ—¶è¡¨ã€‚å¦‚æœè¡¨å˜é‡åŒ…å«å¤§é‡æ•°æ®ï¼Œè¯·æ³¨æ„ç´¢å¼•éå¸¸æœ‰é™(åªæœ‰ä¸»é”®ç´¢å¼•)ã€‚</li><li>é¿å…é¢‘ç¹åˆ›å»ºå’Œåˆ é™¤ä¸´æ—¶è¡¨ï¼Œä»¥å‡å°‘ç³»ç»Ÿè¡¨èµ„æºçš„æ¶ˆè€—ã€‚</li><li>ä¸´æ—¶è¡¨å¹¶ä¸æ˜¯ä¸å¯ä½¿ç”¨ï¼Œé€‚å½“åœ°ä½¿ç”¨å®ƒä»¬å¯ä»¥ä½¿æŸäº›ä¾‹ç¨‹æ›´æœ‰æ•ˆï¼Œä¾‹å¦‚ï¼Œå½“éœ€è¦é‡å¤å¼•ç”¨å¤§å‹è¡¨æˆ–å¸¸ç”¨ è¡¨ä¸­çš„æŸä¸ªæ•°æ®é›†æ—¶ã€‚ä½†æ˜¯ï¼Œå¯¹äºä¸€æ¬¡æ€§äº‹ä»¶ï¼Œ æœ€å¥½ä½¿ç”¨å¯¼å‡ºè¡¨ã€‚</li><li>åœ¨æ–°å»ºä¸´æ—¶è¡¨æ—¶ï¼Œå¦‚æœä¸€æ¬¡æ€§æ’å…¥æ•°æ®é‡å¾ˆå¤§ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ select into ä»£æ›¿ create table,é¿å…é€ æˆå¤§é‡ log ,ä»¥æé«˜é€Ÿåº¦;å¦‚æœæ•°æ®é‡ä¸å¤§ï¼Œä¸ºäº†ç¼“å’Œç³»ç»Ÿè¡¨çš„èµ„æºï¼Œåº”å…ˆ create table,ç„¶å insert.</li><li>å¦‚æœä½¿ç”¨åˆ°äº†ä¸´æ—¶è¡¨ï¼Œ åœ¨å­˜å‚¨è¿‡ç¨‹çš„æœ€ååŠ¡å¿…å°†æ‰€æœ‰çš„ä¸´æ—¶è¡¨æ˜¾å¼åˆ é™¤ï¼Œ å…ˆ truncate table ,ç„¶å drop table ,è¿™æ ·å¯ä»¥é¿å…ç³»ç»Ÿè¡¨çš„è¾ƒé•¿æ—¶é—´é”å®šã€‚</li><li>å°½é‡é¿å…ä½¿ç”¨æ¸¸æ ‡ï¼Œå› ä¸ºæ¸¸æ ‡çš„æ•ˆç‡è¾ƒå·®ï¼Œå¦‚æœæ¸¸æ ‡æ“ä½œçš„æ•°æ®è¶…è¿‡ 1 ä¸‡è¡Œï¼Œé‚£ä¹ˆå°±åº”è¯¥è€ƒè™‘æ”¹å†™ã€‚</li><li>ä½¿ç”¨åŸºäºæ¸¸æ ‡çš„æ–¹æ³•æˆ–ä¸´æ—¶è¡¨æ–¹æ³•ä¹‹å‰ï¼Œåº”å…ˆå¯»æ‰¾åŸºäºé›†çš„è§£å†³æ–¹æ¡ˆæ¥è§£å†³é—®é¢˜ï¼ŒåŸºäºé›†çš„æ–¹æ³•é€šå¸¸æ›´ æœ‰æ•ˆã€‚</li><li>ä¸ä¸´æ—¶è¡¨ä¸€æ ·ï¼Œæ¸¸æ ‡å¹¶ä¸æ˜¯ä¸å¯ä½¿ç”¨ã€‚å¯¹å°å‹æ•°æ®é›†ä½¿ç”¨ FAST_FORWARD æ¸¸æ ‡é€šå¸¸è¦ä¼˜äºå…¶ä»–é€è¡Œå¤„ç†æ–¹æ³•ï¼Œå°¤å…¶æ˜¯åœ¨å¿…é¡»å¼•ç”¨å‡ ä¸ªè¡¨æ‰èƒ½è·å¾—æ‰€éœ€çš„æ•°æ®æ—¶ã€‚åœ¨ç»“æœé›†ä¸­åŒ…æ‹¬â€œåˆè®¡â€çš„ä¾‹ç¨‹é€šå¸¸è¦æ¯”ä½¿ç”¨æ¸¸æ ‡æ‰§è¡Œçš„é€Ÿåº¦å¿«ã€‚å¦‚æœå¼€å‘æ—¶é—´å…è®¸ï¼ŒåŸºäºæ¸¸æ ‡çš„æ–¹æ³•å’ŒåŸºäºé›†çš„æ–¹æ³•éƒ½å¯ä»¥å°è¯•ä¸€ä¸‹ï¼Œçœ‹å“ªä¸€ç§æ–¹æ³•çš„æ•ˆæœæ›´å¥½ã€‚</li><li>åœ¨æ‰€æœ‰çš„å­˜å‚¨è¿‡ç¨‹å’Œè§¦å‘å™¨çš„å¼€å§‹å¤„è®¾ç½® SET NOCOUNT ON ,åœ¨ç»“æŸæ—¶è®¾ç½® SET NOCOUNT OFF .æ— éœ€åœ¨æ‰§è¡Œå­˜å‚¨è¿‡ç¨‹å’Œè§¦å‘å™¨çš„æ¯ä¸ªè¯­å¥åå‘å®¢æˆ·ç«¯å‘é€ DONE_IN_PROC æ¶ˆæ¯ã€‚</li><li>å°½é‡é¿å…å¤§äº‹åŠ¡æ“ä½œï¼Œæé«˜ç³»ç»Ÿå¹¶å‘èƒ½åŠ›ã€‚ sql ä¼˜åŒ–æ–¹æ³•ä½¿ç”¨ç´¢å¼•æ¥æ›´å¿«åœ°éå†è¡¨ã€‚ ç¼ºçœæƒ…å†µä¸‹å»ºç«‹çš„ç´¢å¼•æ˜¯éç¾¤é›†ç´¢å¼•ï¼Œä½†æœ‰æ—¶å®ƒå¹¶ä¸æ˜¯æœ€ä½³çš„ã€‚åœ¨éç¾¤é›†ç´¢å¼•ä¸‹ï¼Œæ•°æ®åœ¨ç‰©ç†ä¸Šéšæœºå­˜æ”¾åœ¨æ•°æ®é¡µä¸Šã€‚åˆç†çš„ç´¢å¼•è®¾è®¡è¦å»ºç«‹åœ¨å¯¹å„ç§æŸ¥è¯¢çš„åˆ†æå’Œé¢„æµ‹ä¸Šã€‚ä¸€èˆ¬æ¥è¯´ï¼š<br>a.æœ‰å¤§é‡é‡å¤å€¼ã€ä¸”ç»å¸¸æœ‰èŒƒå›´æŸ¥è¯¢( &gt; ,&lt; ,&gt; =,&lt; =)å’Œ order byã€group by å‘ç”Ÿçš„åˆ—ï¼Œå¯è€ƒè™‘å»ºç«‹é›†ç¾¤ç´¢å¼•;<br>b.ç»å¸¸åŒæ—¶å­˜å–å¤šåˆ—ï¼Œä¸”æ¯åˆ—éƒ½å«æœ‰é‡å¤å€¼å¯è€ƒè™‘å»ºç«‹ç»„åˆç´¢å¼•;<br>c.ç»„åˆç´¢å¼•è¦å°½é‡ä½¿å…³é”®æŸ¥è¯¢å½¢æˆç´¢å¼•è¦†ç›–ï¼Œå…¶å‰å¯¼åˆ—ä¸€å®šæ˜¯ä½¿ç”¨æœ€é¢‘ç¹çš„åˆ—ã€‚ç´¢å¼•è™½æœ‰åŠ©äºæé«˜æ€§èƒ½ä½† ä¸æ˜¯ç´¢å¼•è¶Šå¤šè¶Šå¥½ï¼Œæ°å¥½ç›¸åè¿‡å¤šçš„ç´¢å¼•ä¼šå¯¼è‡´ç³»ç»Ÿä½æ•ˆã€‚ç”¨æˆ·åœ¨è¡¨ä¸­æ¯åŠ è¿›ä¸€ä¸ªç´¢å¼•ï¼Œç»´æŠ¤ç´¢å¼•é›†åˆå°± è¦åšç›¸åº”çš„æ›´æ–°å·¥ä½œã€‚</li><li>å®šæœŸåˆ†æè¡¨å’Œæ£€æŸ¥è¡¨ã€‚<br>åˆ†æè¡¨çš„è¯­æ³•ï¼šANALYZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tb1_name[, tbl_name]â€¦<br>ä»¥ä¸Šè¯­å¥ç”¨äºåˆ†æå’Œå­˜å‚¨è¡¨çš„å…³é”®å­—åˆ†å¸ƒï¼Œåˆ†æçš„ç»“æœå°†å¯ä»¥ä½¿å¾—ç³»ç»Ÿå¾—åˆ°å‡†ç¡®çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œä½¿å¾—SQLèƒ½å¤Ÿç”Ÿæˆæ­£ç¡®çš„æ‰§è¡Œè®¡åˆ’ã€‚å¦‚æœç”¨æˆ·æ„Ÿè§‰å®é™…æ‰§è¡Œè®¡åˆ’å¹¶ä¸æ˜¯é¢„æœŸçš„æ‰§è¡Œè®¡åˆ’ï¼Œæ‰§è¡Œä¸€æ¬¡åˆ†æè¡¨å¯èƒ½ä¼šè§£å†³é—®é¢˜ã€‚åœ¨åˆ†ææœŸé—´ï¼Œä½¿ç”¨ä¸€ä¸ªè¯»å–é”å®šå¯¹è¡¨è¿›è¡Œé”å®šã€‚è¿™å¯¹äºMyISAMï¼ŒDBDå’ŒInnoDBè¡¨æœ‰ä½œç”¨ã€‚<br>ä¾‹å¦‚åˆ†æä¸€ä¸ªæ•°æ®è¡¨ï¼šanalyze table table_name<br>æ£€æŸ¥è¡¨çš„è¯­æ³•ï¼šCHECK TABLE tb1_name[,tbl_name]â€¦[option]â€¦option = {QUICK | FAST | MEDIUM | EXTENDED | CHANGED}<br>æ£€æŸ¥è¡¨çš„ä½œç”¨æ˜¯æ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ªè¡¨æ˜¯å¦æœ‰é”™è¯¯ï¼ŒCHECK TABLE å¯¹MyISAM å’Œ InnoDBè¡¨æœ‰ä½œç”¨ï¼Œå¯¹äºMyISAMè¡¨ï¼Œå…³é”®å­—ç»Ÿè®¡æ•°æ®è¢«æ›´æ–°<br>CHECK TABLE ä¹Ÿå¯ä»¥æ£€æŸ¥è§†å›¾æ˜¯å¦æœ‰é”™è¯¯ï¼Œæ¯”å¦‚åœ¨è§†å›¾å®šä¹‰ä¸­è¢«å¼•ç”¨çš„è¡¨ä¸å­˜åœ¨ã€‚</li><li>å®šæœŸä¼˜åŒ–è¡¨ã€‚<br>ä¼˜åŒ–è¡¨çš„è¯­æ³•ï¼šOPTIMIZE [LOCAL | NO_WRITE_TO_BINLOG] TABLE tb1_name [,tbl_name]â€¦<br>å¦‚æœåˆ é™¤äº†è¡¨çš„ä¸€å¤§éƒ¨åˆ†ï¼Œæˆ–è€…å¦‚æœå·²ç»å¯¹å«æœ‰å¯å˜é•¿åº¦è¡Œçš„è¡¨(å«æœ‰ VARCHARã€BLOBæˆ–TEXTåˆ—çš„è¡¨)è¿›è¡Œæ›´å¤šæ›´æ”¹ï¼Œåˆ™åº”ä½¿ç”¨OPTIMIZE TABLEå‘½ä»¤æ¥è¿›è¡Œè¡¨ä¼˜åŒ–ã€‚è¿™ä¸ªå‘½ä»¤å¯ä»¥å°†è¡¨ä¸­çš„ç©ºé—´ç¢ç‰‡è¿›è¡Œåˆå¹¶ï¼Œå¹¶ä¸”å¯ä»¥æ¶ˆé™¤ç”±äºåˆ é™¤æˆ–è€…æ›´æ–°é€ æˆçš„ç©ºé—´æµªè´¹ï¼Œä½†OPTIMIZE TABLE å‘½ä»¤åªå¯¹MyISAMã€ BDB å’ŒInnoDBè¡¨èµ·ä½œç”¨ã€‚<br>ä¾‹å¦‚ï¼š optimize table table_name<br>æ³¨æ„ï¼š analyzeã€checkã€optimizeæ‰§è¡ŒæœŸé—´å°†å¯¹è¡¨è¿›è¡Œé”å®šï¼Œå› æ­¤ä¸€å®šæ³¨æ„è¦åœ¨MySQLæ•°æ®åº“ä¸ç¹å¿™çš„æ—¶å€™æ‰§è¡Œç›¸å…³çš„æ“ä½œã€‚</li></ol><h3 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h3><ol><li>åœ¨æµ·é‡æŸ¥è¯¢æ—¶å°½é‡å°‘ç”¨æ ¼å¼è½¬æ¢ã€‚</li><li>ORDER BY å’Œ GROPU BY:ä½¿ç”¨ ORDER BY å’Œ GROUP BY çŸ­è¯­ï¼Œä»»ä½•ä¸€ç§ç´¢å¼•éƒ½æœ‰åŠ©äº SELECT çš„æ€§èƒ½æé«˜ã€‚</li><li>ä»»ä½•å¯¹åˆ—çš„æ“ä½œéƒ½å°†å¯¼è‡´è¡¨æ‰«æï¼Œå®ƒåŒ…æ‹¬æ•°æ®åº“æ•™ç¨‹å‡½æ•°ã€è®¡ç®—è¡¨è¾¾å¼ç­‰ç­‰ï¼ŒæŸ¥è¯¢æ—¶è¦å°½å¯èƒ½å°†æ“ä½œç§» è‡³ç­‰å·å³è¾¹ã€‚</li><li>INã€OR å­å¥å¸¸ä¼šä½¿ç”¨å·¥ä½œè¡¨ï¼Œä½¿ç´¢å¼•å¤±æ•ˆã€‚å¦‚æœä¸äº§ç”Ÿå¤§é‡é‡å¤å€¼ï¼Œå¯ä»¥è€ƒè™‘æŠŠå­å¥æ‹†å¼€ã€‚æ‹†å¼€çš„å­ å¥ä¸­åº”è¯¥åŒ…å«ç´¢å¼•ã€‚</li><li>åªè¦èƒ½æ»¡è¶³ä½ çš„éœ€æ±‚ï¼Œåº”å°½å¯èƒ½ä½¿ç”¨æ›´å°çš„æ•°æ®ç±»å‹ï¼šä¾‹å¦‚ä½¿ç”¨ MEDIUMINT ä»£æ›¿ INT</li><li>å°½é‡æŠŠæ‰€æœ‰çš„åˆ—è®¾ç½®ä¸º NOT NULL,å¦‚æœä½ è¦ä¿å­˜ NULL,æ‰‹åŠ¨å»è®¾ç½®å®ƒï¼Œè€Œä¸æ˜¯æŠŠå®ƒè®¾ä¸ºé»˜è®¤å€¼ã€‚</li><li>å°½é‡å°‘ç”¨ VARCHARã€TEXTã€BLOB ç±»å‹</li><li>å¦‚æœä½ çš„æ•°æ®åªæœ‰ä½ æ‰€çŸ¥çš„å°‘é‡çš„å‡ ä¸ªã€‚æœ€å¥½ä½¿ç”¨ ENUM ç±»å‹</li><li>æ­£å¦‚ graymice æ‰€è®²çš„é‚£æ ·ï¼Œå»ºç«‹ç´¢å¼•ã€‚</li><li>åˆç†ç”¨è¿åˆ†è¡¨ä¸åˆ†åŒºè¡¨æé«˜æ•°æ®å­˜æ”¾å’Œæå–é€Ÿåº¦ã€‚</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;åŸºç¡€&quot;&gt;&lt;a href=&quot;#åŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;åŸºç¡€&quot;&gt;&lt;/a&gt;åŸºç¡€&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;å¯¹æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ï¼Œåº”å°½é‡é¿å…å…¨è¡¨æ‰«æï¼Œé¦–å…ˆåº”è€ƒè™‘åœ¨ where åŠ order by æ¶‰åŠçš„åˆ—ä¸Šå»ºç«‹ç´¢å¼•ã€‚&lt;/li&gt;
&lt;li&gt;åº”å°½
      
    
    </summary>
    
    
      <category term="sql" scheme="http://www.zzzhy.cn/categories/sql/"/>
    
    
      <category term="tuning" scheme="http://www.zzzhy.cn/tags/tuning/"/>
    
      <category term="sql" scheme="http://www.zzzhy.cn/tags/sql/"/>
    
  </entry>
  
  <entry>
    <title>akka best practice</title>
    <link href="http://www.zzzhy.cn/2019/10/30/akka-best-practice/"/>
    <id>http://www.zzzhy.cn/2019/10/30/akka-best-practice/</id>
    <published>2019-10-29T17:12:36.000Z</published>
    <updated>2019-11-14T16:28:41.979Z</updated>
    
    <content type="html"><![CDATA[<ul><li>ä½¿ç”¨tellè€Œéaskï¼ŒExtraActoræ¨¡å¼</li><li>ä½¿ç”¨dispatcheréš”ç¦»è€—æ—¶é˜»å¡ä»»åŠ¡ï¼ŒåŒºåˆ†ä¸åŒçš„ä»»åŠ¡ç±»åˆ«ä½¿ç”¨ä¸åŒçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± </li><li>ä¸€èˆ¬æ¥è¯´ForkJoinPoolçš„æ•ˆç‡æœ€é«˜</li><li>ä½¿ç”¨routeræ¥è¿›è¡Œå¤šæ ¸ç¼–ç¨‹ï¼ŒBalancePoolé€‚ç”¨äºæœ¬åœ°ï¼Œæ‰€æœ‰actorå…±ç”¨ä¸€ä¸ªé‚®ç®±</li><li>åŒ…å«çŠ¶æ€çš„å¯ä»¥ä½¿ç”¨become/unbecomeæ¥è¿›è¡Œç¼–ç¨‹ï¼Œä½¿çŠ¶æ€æ¸…æ™°ï¼Œä»£ç é€»è¾‘ç»“æ„ç®€å•</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;ä½¿ç”¨tellè€Œéaskï¼ŒExtraActoræ¨¡å¼&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨dispatcheréš”ç¦»è€—æ—¶é˜»å¡ä»»åŠ¡ï¼ŒåŒºåˆ†ä¸åŒçš„ä»»åŠ¡ç±»åˆ«ä½¿ç”¨ä¸åŒçº¿ç¨‹æ•°é‡çš„çº¿ç¨‹æ± &lt;/li&gt;
&lt;li&gt;ä¸€èˆ¬æ¥è¯´ForkJoinPoolçš„æ•ˆç‡æœ€é«˜&lt;/li&gt;
&lt;li&gt;ä½¿ç”¨routeræ¥è¿›è¡Œå¤šæ ¸ç¼–
      
    
    </summary>
    
    
      <category term="akka" scheme="http://www.zzzhy.cn/categories/akka/"/>
    
    
      <category term="akka" scheme="http://www.zzzhy.cn/tags/akka/"/>
    
      <category term="actor" scheme="http://www.zzzhy.cn/tags/actor/"/>
    
      <category term="tuning" scheme="http://www.zzzhy.cn/tags/tuning/"/>
    
  </entry>
  
  <entry>
    <title>spark streamingå…¥é—¨</title>
    <link href="http://www.zzzhy.cn/2019/10/30/spark-streaming-indoor/"/>
    <id>http://www.zzzhy.cn/2019/10/30/spark-streaming-indoor/</id>
    <published>2019-10-29T16:31:45.000Z</published>
    <updated>2019-11-14T16:31:28.903Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ„å»ºä¸€ä¸ª Spark Streaming åº”ç”¨ç¨‹åºçš„4 ä¸ªæ­¥éª¤</span></span><br><span class="line">scala&gt; val ssc = new StreamingContext(sc,Seconds(5))</span><br><span class="line"></span><br><span class="line">scala&gt; val lines = ssc.socketTextStream(<span class="string">"localhost"</span>,9999)</span><br><span class="line"></span><br><span class="line">scala&gt; val words = lines.flatMap(_.split(<span class="string">" "</span>))</span><br><span class="line"></span><br><span class="line">scala&gt; val pairs = words.map(word =&gt; (word,1))</span><br><span class="line"></span><br><span class="line">scala&gt; val wordCounts = pairs.reduceByKey(_+_)</span><br><span class="line"></span><br><span class="line">scala&gt; wordCounts.print()</span><br><span class="line"></span><br><span class="line">scala&gt; ssc.start()</span><br></pre></td></tr></table></figure><h2 id="æ„å»º-Streaming-Context-å¯¹è±¡"><a href="#æ„å»º-Streaming-Context-å¯¹è±¡" class="headerlink" title="æ„å»º Streaming Context å¯¹è±¡"></a>æ„å»º Streaming Context å¯¹è±¡</h2><blockquote><p>ä½¿ç”¨ Spark Streaming éœ€è¦åˆ›å»º StreamingContext å¯¹è±¡ã€‚Spark Streaming éœ€è¦åˆ¶å®šå¤„ç†æ•°æ®çš„æ—¶é—´é—´éš”ï¼Œå¦‚ 1sï¼Œé‚£ä¹ˆ Spark Streaming ä¼šä»¥1sä¸ºæ—¶é—´çª—å£è¿›è¡Œæ•°æ®å¤„ç†ã€‚æ­¤å‚æ•°éœ€è¦æ ¹æ®ç”¨æˆ·çš„éœ€æ±‚å’Œé›†ç¾¤çš„å¤„ç†èƒ½åŠ›è¿›è¡Œé€‚å½“çš„è®¾ç½®ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸä¼šä¼´éšæ•´ä¸ªStreamingContext çš„ç”Ÿå‘½å‘¨æœŸä¸”æ— æ³•é‡æ–°è®¾ç½®ã€‚å› æ­¤ï¼Œç”¨æˆ·éœ€è¦ä»éœ€æ±‚å’Œé›†ç¾¤å¤„ç†èƒ½åŠ›å‡ºå‘ï¼Œè®¾ç½®ä¸€ä¸ªåˆç†çš„æ—¶é—´é—´éš”ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SparkConf sparkConf = <span class="keyword">new</span> SparkConf().setAppName(<span class="string">"JavaRecoverableNetworkWordCount"</span>);</span><br><span class="line"> <span class="comment">// Create the context with a 1 second batch size</span></span><br><span class="line"> <span class="comment">//é¦–å…ˆé€šè¿‡ JavaStreamingContextFactory åˆ›å»º Spark Streaming è¿‡ç¨‹ã€‚</span></span><br><span class="line"> JavaStreamingContext ssc = <span class="keyword">new</span> JavaStreamingContext(sparkConf, Durations.seconds(<span class="number">1</span>));</span><br><span class="line"> ssc.checkpoint(checkpointDirectory);</span><br></pre></td></tr></table></figure><blockquote><p>Spark Streaming æœ‰ç‰¹å®šçš„çª—å£æ“ä½œï¼Œçª—å£æ“ä½œæ¶‰åŠä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªæ˜¯æ»‘åŠ¨çª—å£çš„å®½åº¦ï¼ˆWindow Durationï¼‰ï¼›å¦ä¸€ä¸ªæ˜¯çª—å£æ»‘åŠ¨çš„é¢‘ç‡ï¼ˆSlide Durationï¼‰ï¼Œè¿™ä¸¤ä¸ªå‚æ•°å¿…é¡»æ˜¯ batch size çš„å€æ•°ã€‚ä¾‹å¦‚ä»¥è¿‡å» 5 ç§’é’Ÿä¸ºä¸€ä¸ªè¾“å…¥çª—å£ï¼Œæ¯ 1 ç§’ç»Ÿè®¡ä¸€ä¸‹ WordCountï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼šå°†è¿‡å» 5 ç§’é’Ÿçš„æ¯ä¸€ç§’é’Ÿçš„ WordCount éƒ½è¿›è¡Œç»Ÿè®¡ï¼Œç„¶åè¿›è¡Œå åŠ ï¼Œå¾—å‡ºè¿™ä¸ªçª—å£ä¸­çš„å•è¯ç»Ÿè®¡ã€‚</p></blockquote><h2 id="åˆ›å»º-InputDStream"><a href="#åˆ›å»º-InputDStream" class="headerlink" title="åˆ›å»º InputDStream"></a>åˆ›å»º InputDStream</h2><blockquote><p>å¦‚åŒ Strom çš„ Spout ä¸€æ ·ï¼ŒSpark Streaming éœ€è¦æŒ‡æ˜æ•°æ®æºã€‚ä¾‹å¦‚ socketTextStreamï¼ŒSpark Streaming å°†ä»¥å¥—æ¥å­—è¿æ¥ä½œä¸ºæ•°æ®æºè¯»å–æ•°æ®ã€‚å½“ç„¶ï¼ŒSpark Streaming æ”¯æŒå¤šç§ä¸åŒçš„æ•°æ®æºï¼ŒåŒ…æ‹¬ kafkaStreamã€flumeStreamã€fileStreamã€networkStream ç­‰ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JavaReceiverInputDStream&lt;<span class="built_in">String</span>&gt; lines = ssc.socketTextStream(ip, port);</span><br></pre></td></tr></table></figure><h2 id="æ“ä½œ-DStream"><a href="#æ“ä½œ-DStream" class="headerlink" title="æ“ä½œ DStream"></a>æ“ä½œ DStream</h2><blockquote><p>å¯¹äºä»æ•°æ®æºå¾—åˆ°çš„DStreamï¼Œç”¨æˆ·å¯ä»¥åœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œå„ç§æ“ä½œï¼Œå¦‚ WordCount çš„æ“ä½œå°±æ˜¯ä¸€ä¸ªå…¸å‹çš„å•è¯è®¡æ•°æ‰§è¡Œæµç¨‹ï¼Œå³å¯¹å½“å‰æ—¶é—´çª—å£å†…ä»æ•°æ®æºå¾—åˆ°çš„æ•°æ®è¿›è¡Œåˆ†è¯ï¼Œç„¶ååˆ©ç”¨ MapReduce ç®—æ³•æ˜ å°„å’Œè®¡ç®—ï¼Œæœ€åä½¿ç”¨ print() è¾“å‡ºç»“æœã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">JavaDStream&lt;<span class="built_in">String</span>&gt; words = lines.flatMap(s -&gt; Lists.newArrayList(SPACE.split(s)));</span><br><span class="line"> JavaPairDStream&lt;<span class="built_in">String</span>, Integer&gt; wordCounts = words.mapToPair(w -&gt; <span class="keyword">new</span> Tuple2&lt;<span class="built_in">String</span>, Integer&gt;(w, <span class="number">1</span>)).reduceByKey((a,b)-&gt;a+b);</span><br><span class="line"></span><br><span class="line"> wordCounts.foreachRDD((rdd,time) -&gt; &#123;</span><br><span class="line">    <span class="built_in">String</span> counts = <span class="string">"Counts at time "</span> + time + <span class="string">" "</span> + rdd.collect();</span><br><span class="line">    System.out.println(counts);</span><br><span class="line">    System.out.println(<span class="string">"Appending to "</span> + outputFile.getAbsolutePath());</span><br><span class="line">    Files.append(counts + <span class="string">"\n"</span>, outputFile, Charset.defaultCharset());</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨-Spark-Streaming"><a href="#å¯åŠ¨-Spark-Streaming" class="headerlink" title="å¯åŠ¨ Spark Streaming"></a>å¯åŠ¨ Spark Streaming</h2><blockquote><p>ä¹‹å‰çš„æ‰€æœ‰æ­¥éª¤åªåˆ›å»ºäº†æ‰§è¡Œæµç¨‹ï¼Œç¨‹åºæ²¡æœ‰æœ‰çœŸæ­£è¿æ¥ä¸Šæ•°æ®æºï¼Œä¹Ÿæ²¡æœ‰å¯¹æ•°æ®è¿›è¡Œä»»ä½•æ“ä½œï¼Œåªæ˜¯è®¾å®šå¥½äº†æ‰€æœ‰çš„æ‰§è¡Œè®¡ç®—ï¼Œå½“ ssc.start() å¯åŠ¨åï¼Œç¨‹åºæ‰çœŸæ­£è¿›è¡Œæ‰€æœ‰é¢„æœŸçš„æ“ä½œã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssc.start();</span><br><span class="line">ssc.awaitTermination();</span><br></pre></td></tr></table></figure><h2 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h2><ol><li>Spark Streaming å†…éƒ¨çš„å®ç°å’Œè°ƒåº¦æ–¹å¼é«˜åº¦ä¾èµ– Spark çš„ DAG è°ƒåº¦å™¨å’Œ RDDï¼Œè¿™å°±å†³å®šäº† Spark Streaming çš„è®¾è®¡åˆè¡·å¿…é¡»æ˜¯ç²—ç²’åº¦æ–¹å¼çš„ï¼ŒåŒæ—¶ï¼Œç”±äº Spark å†…éƒ¨è°ƒåº¦å™¨è¶³å¤Ÿå¿«é€Ÿå’Œé«˜æ•ˆï¼Œå¯ä»¥å¿«é€Ÿåœ°å¤„ç†å°æ‰¹é‡æ•°æ®ï¼Œè¿™å°±è·å¾—å‡†å®æ—¶çš„ç‰¹æ€§ã€‚</li><li>Spark Streaming çš„ç²—ç²’åº¦æ‰§è¡Œæ–¹å¼ä½¿å…¶ç¡®ä¿â€œå¤„ç†ä¸”ä»…å¤„ç†ä¸€æ¬¡â€çš„ç‰¹æ€§ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥æ›´æ–¹ä¾¿åœ°å®ç°å®¹é”™æ¢å¤æœºåˆ¶ã€‚</li><li>ç”±äº Spark Streaming çš„ DStream æœ¬è´¨æ˜¯ RDD åœ¨æµå¼æ•°æ®ä¸Šçš„æŠ½è±¡ï¼Œå› æ­¤åŸºäº RDD çš„å„ç§æ“ä½œä¹Ÿæœ‰ç›¸åº”çš„åŸºäº DStream çš„ç‰ˆæœ¬ï¼Œè¿™æ ·å°±å¤§å¤§é™ä½äº†ç”¨æˆ·å¯¹äºæ–°æ¡†æ¶çš„å­¦ä¹ æˆæœ¬ï¼Œåœ¨äº†è§£ Spark çš„æƒ…å†µä¸‹ç”¨æˆ·å°†å¾ˆå®¹æ˜“ä½¿ç”¨ Spark Streamingã€‚</li><li>ç”±äº DStream æ˜¯åœ¨ RDD ä¸Šçš„æŠ½è±¡ï¼Œé‚£ä¹ˆä¹Ÿå°±æ›´å®¹æ˜“ä¸ RDD è¿›è¡Œäº¤äº’æ“ä½œï¼Œåœ¨éœ€è¦å°†æµå¼æ•°æ®å’Œæ‰¹å¤„ç†æ•°æ®ç»“åˆè¿›è¡Œåˆ†æçš„æƒ…å†µä¸‹ï¼Œå°†ä¼šå˜å¾—éå¸¸æ–¹ä¾¿ã€‚</li></ol><h2 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h2><ol><li>Spark Streaming çš„ç²—ç²’åº¦å¤„ç†æ–¹å¼ä¹Ÿé€ æˆäº†ä¸å¯é¿å…çš„å»¶è¿Ÿã€‚åœ¨ç»†ç²’åº¦å¤„ç†æ–¹å¼ä¸‹ï¼Œç†æƒ³æƒ…å†µä¸‹æ¯ä¸€æ¡è®°å½•éƒ½ä¼šè¢«å®æ—¶å¤„ç†ï¼Œè€Œåœ¨ Spark Streaming ä¸­ï¼Œæ•°æ®éœ€è¦æ±‡æ€»åˆ°ä¸€å®šçš„é‡åå†ä¸€æ¬¡æ€§å¤„ç†ï¼Œè¿™å°±å¢åŠ äº†æ•°æ®å¤„ç†çš„å»¶è¿Ÿï¼Œè¿™ç§å»¶è¿Ÿæ˜¯ç”±æ¡†æ¶çš„è®¾è®¡å¼•å…¥çš„ï¼Œå¹¶ä¸æ˜¯ç”±ç½‘ç»œæˆ–å…¶ä»–æƒ…å†µé€ æˆçš„ã€‚</li><li>Spark Streaming å½“å‰ç‰ˆæœ¬ç¨³å®šæ€§ä¸æ˜¯å¾ˆå¥½ã€‚<br>æ€»è€Œè¨€ä¹‹ï¼ŒSpark Streaming ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ç§å´­æ–°çš„æµå¼å¤„ç†æ¡†æ¶ï¼Œç›¸ä¿¡æœªæ¥éšç€ Spark Streaming ä¼šåœ¨æ˜“ç”¨æ€§ã€ç¨³å®šæ€§ä»¥åŠå…¶ä»–æ–¹é¢æœ‰å¾ˆå¤§çš„æå‡ã€‚</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=
      
    
    </summary>
    
    
      <category term="spark" scheme="http://www.zzzhy.cn/categories/spark/"/>
    
    
      <category term="scala" scheme="http://www.zzzhy.cn/tags/scala/"/>
    
      <category term="spark" scheme="http://www.zzzhy.cn/tags/spark/"/>
    
      <category term="spark streaming" scheme="http://www.zzzhy.cn/tags/spark-streaming/"/>
    
  </entry>
  
  <entry>
    <title>spark streaming åŸºç¡€ä¸è°ƒä¼˜</title>
    <link href="http://www.zzzhy.cn/2019/10/30/spark-streaming-tuning/"/>
    <id>http://www.zzzhy.cn/2019/10/30/spark-streaming-tuning/</id>
    <published>2019-10-29T16:27:23.000Z</published>
    <updated>2019-11-14T16:31:57.795Z</updated>
    
    <content type="html"><![CDATA[<h2 id="spark-streamingçš„çŠ¶æ€æ›´æ–°"><a href="#spark-streamingçš„çŠ¶æ€æ›´æ–°" class="headerlink" title="spark-streamingçš„çŠ¶æ€æ›´æ–°"></a>spark-streamingçš„çŠ¶æ€æ›´æ–°</h2><p>updateStateByKeyã€reduceByKeyAndWindow<br><strong>å¿…é¡»å¯ç”¨æ£€æŸ¥ç‚¹åŠŸèƒ½ï¼Œå› ä¸ºæœ‰çŠ¶æ€çš„æ“ä½œæ˜¯ä»ç¨‹åºå¼€å§‹æ—¶ä¸€ç›´è¿›è¡Œçš„</strong></p><h2 id="DStreamæ“ä½œ"><a href="#DStreamæ“ä½œ" class="headerlink" title="DStreamæ“ä½œ"></a>DStreamæ“ä½œ</h2><ul><li>ä¸RDDç›¸åŒçš„æ“ä½œæ–¹æ³•</li><li>transformï¼šç”¨äºç›´æ¥æ“ä½œDStreamå†…éƒ¨çš„RDDï¼Œé‚£äº›DStreamæ²¡æœ‰æä¾›çš„RDDæ“ä½œï¼Œå¯ä»¥é€šè¿‡transformè°ƒç”¨å®ç°ã€‚å¦‚joinï¼š<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">val joinedDStream = d.transform(<span class="function"><span class="params">rdd</span> =&gt;</span> &#123;</span><br><span class="line">    rdd.join(rdd2)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><h3 id="çª—å£æ“ä½œ"><a href="#çª—å£æ“ä½œ" class="headerlink" title="çª—å£æ“ä½œ"></a>çª—å£æ“ä½œ</h3><ul><li>çª—å£é•¿åº¦<blockquote><p>çª—å£è·¨è¶Šçš„å‘¨æœŸæ¬¡æ•°ï¼Œæ¯æ¬¡çª—å£å¤„ç†çš„æ•°æ®åˆ†ç‰‡æ•°</p></blockquote></li><li>æ»‘åŠ¨åŒºé—´<blockquote><p>ä»å½“å‰çª—å£åˆ°ä¸‹ä¸€ä¸ªçª—å£é—´éš”çš„å‘¨æœŸæ•°é‡,æ¯æ¬¡åˆ’è¿‡çš„çª—å£æ•°<br>å¦‚æœè¿™ä¸¤ä¸ªå‚æ•°çš„å€¼éƒ½æ˜¯1ï¼Œåˆ™è·Ÿä¸ä½¿ç”¨çª—å£æ•ˆæœä¸€æ ·ã€‚æ¯ä¸ªçª—å£çš„å‘¨æœŸæ•°æ®éƒ½ä¼šåˆå¹¶æˆä¸€ä¸ªRDDä¿å­˜åœ¨DStreamä¸­ã€‚</p></blockquote></li><li>çª—å£å‡½æ•°<br>ç”¨windowLengthã€slideIntervalç”Ÿæˆä¸€ä¸ªå¸¦çª—å£çš„DStreamï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŠ çª—å£å‚æ•°çš„æ–¹æ³•ï¼šcountByWindowã€reduceByWindowã€reduceByKeyAndWindowã€countByValueAndWindow.</li></ul><h3 id="é«˜çº§æ“ä½œ"><a href="#é«˜çº§æ“ä½œ" class="headerlink" title="é«˜çº§æ“ä½œ"></a>é«˜çº§æ“ä½œ</h3><ol><li><p>ç¼“å­˜ä¸æŒä¹…åŒ–<br>çª—å£å‡½æ•°å’ŒupdateStateByKeyä¼šé»˜è®¤è‡ªåŠ¨æŒä¹…åŒ–<br>ä»ç½‘ç»œæ¥æ”¶æ•°æ®çš„è¾“å…¥DStreamï¼Œé»˜è®¤æŒä¹…åŒ–çº§åˆ«æ˜¯å¤åˆ¶æ•°æ®åˆ°ä¸¤ä¸ªèŠ‚ç‚¹ä¸Šï¼Œä»¥ç¡®ä¿å®¹é”™èƒ½åŠ›ã€‚</p></li><li><p>æ‰“åŒ…ã€å‘å¸ƒå’Œç›‘æ§</p></li></ol><ul><li>éœ€è¦æä¾›sparkä¹‹å¤–çš„å…¶ä»–æ‰€æœ‰ç¬¬ä¸‰æ–¹jaråŒ…ã€‚</li><li>æœ€å¥½ç”¨hdfsæˆ–s3çš„æ–‡ä»¶ç³»ç»Ÿç›®å½•æ¥é…ç½®æ£€æŸ¥ç‚¹</li><li>é…ç½®driverç¨‹åºè‡ªåŠ¨é‡å¯<blockquote><p>standaloneæ¨¡å¼æäº¤ç”¨â€“deploy-mode cluster â€“supervise,YARNä¸‹é€‰æ‹©yarn-clusterï¼ŒMesosä¸‹é€šè¿‡MarathonååŠ©å®ç°ã€‚</p></blockquote></li><li>ä»1.2å¼€å§‹ï¼Œæ”¯æŒWrite Ahead Logs(WAL)ï¼Œå¼€å¯ä¹‹åï¼Œæ‰€æœ‰æ”¶åˆ°çš„æ•°æ®åœ¨å¤„ç†å‰ä¼šå†™åˆ°æ£€æŸ¥ç‚¹ç›®å½•ä¸‹ï¼Œå¯ç¡®ä¿driveré‡å¯æœŸé—´æ•°æ®ä¸ä¸¢å¤±ã€‚è®¾ç½®spark.streaming.receiver.writeAheadLog.enableä¸ºtrueå¼€å¯ï¼Œä¼šé™ä½æ•°æ®æ¥æ”¶çš„ååé‡ï¼Œä¸è¿‡å¯ä»¥é€šè¿‡é‡‡ç”¨<strong>å¹¶å‘æ¥æ”¶</strong>çš„æ–¹å¼é™ä½å½±å“ã€‚å¦‚æœå¼€å¯äº†WALï¼Œå¯ä»¥å…³é—­æ¥å—æ•°æ®æ—¶çš„å¤åˆ¶æœºåˆ¶ï¼š<strong>è®¾ç½®è¾“å…¥DStreamçš„å­˜å‚¨çº§åˆ«ä¸ºStorageLevel.MEMORY_AND_DISK_SER</strong>ã€‚</li></ul><ol start="3"><li>æ›´æ–°ç¨‹åºä»£ç <br>ä¸ºäº†ä¸ä¸¢å¤±æ•°æ®ï¼Œå¯é‡‡ç”¨ä¸€ä¸‹ä¸¤ç§æ–¹æ³•ï¼š</li></ol><ul><li><strong>æ–°æ—§ç¨‹åºåŒæ—¶è¿è¡Œã€‚</strong> ç­‰æ–°çš„ç¨‹åºè¿è¡Œä¹‹åï¼Œåœ¨åœæ­¢æ—§çš„ç¨‹åºã€‚è¿™ç§æ–¹å¼è¦æ±‚æ•°æ®æºæ”¯æŒåŒæ—¶å‘æ–°ã€æ—§ä¸¤ä¸ªç‰ˆæœ¬çš„ç¨‹åºå‘æ•°æ®</li><li><strong>å…ˆåœæ­¢æ—§çš„ç¨‹åºå†å¯åŠ¨æ–°çš„ç¨‹åºã€‚</strong><br>è¦ä¿è¯æ—§çš„ç¨‹åºæ˜¯è¢«ä¼˜é›…çš„å…³é—­ï¼Œç¡®ä¿å…³é—­å‰æ¥æ”¶åˆ°çš„æ•°æ®éƒ½å¤„ç†å®Œäº†ã€‚è¿™ç§æ–¹å¼åªé€‚ç”¨äº<strong>æ”¯æŒç¼“å­˜æ•°æ®åŠŸèƒ½</strong>çš„æ•°æ®æºï¼Œå¦‚Kafkaã€Flumeã€‚å¯åŠ¨æ–°çš„ç¨‹åºæ—¶åœ¨è¯»å–å‰ä¸€ä¸ªç¨‹åºçš„æ£€æŸ¥ç‚¹ä¿¡æ¯æ—¶å¯èƒ½å‡ºé”™ï¼Œå› ä¸ºæ£€æŸ¥ç‚¹ä¸­ä¸€äº›å¯¹è±¡æ˜¯åºåˆ—åŒ–å­˜å‚¨ï¼Œæ–°çš„å¯¹è±¡ç»“æ„å¯èƒ½å·²ç»æ”¹å˜äº†ã€‚è§£å†³åŠæ³•æ˜¯ï¼š<strong>ç”¨æ–°çš„æ£€æŸ¥ç‚¹ç›®å½•</strong>æˆ–è€…<strong>åˆ é™¤æ—§çš„æ£€æŸ¥ç‚¹ç›®å½•ä¸‹çš„æ‰€æœ‰å†…å®¹</strong>ã€‚</li></ul><h2 id="spark-streamingè°ƒä¼˜æ–¹å‘"><a href="#spark-streamingè°ƒä¼˜æ–¹å‘" class="headerlink" title="spark streamingè°ƒä¼˜æ–¹å‘"></a>spark streamingè°ƒä¼˜æ–¹å‘</h2><ol><li><p>æ¯ä¸ªæ‰¹æ¬¡çš„å¤„ç†æ—¶é—´å°½å¯èƒ½çŸ­</p></li><li><p>æ”¶åˆ°æ•°æ®åå°½å¯èƒ½å¿«çš„å¤„ç†</p></li></ol><h2 id="ä¼˜åŒ–æ–¹æ³•"><a href="#ä¼˜åŒ–æ–¹æ³•" class="headerlink" title="ä¼˜åŒ–æ–¹æ³•"></a>ä¼˜åŒ–æ–¹æ³•</h2><h3 id="å‡å°‘æ‰¹å¤„ç†çš„æ—¶é—´"><a href="#å‡å°‘æ‰¹å¤„ç†çš„æ—¶é—´" class="headerlink" title="å‡å°‘æ‰¹å¤„ç†çš„æ—¶é—´"></a>å‡å°‘æ‰¹å¤„ç†çš„æ—¶é—´</h3><ol><li>å¢åŠ æ•°æ®æ¥æ”¶çš„å¹¶å‘æ•°é‡ï¼Œå°¤å…¶å½“ç“¶é¢ˆå‘ç”Ÿåœ¨æ•°æ®æ¥æ”¶çš„æ—¶å€™ã€‚<blockquote><p>é»˜è®¤æ¯ä¸ªInputDStreamåªä¼šåˆ›å»ºä¸€ä¸ªæ¥æ”¶å™¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºå¤šä¸ªè®©å®ƒä»¬æ¥æ”¶ä¸åŒçš„æ•°æ®åˆ†åŒºï¼Œä»¥å®ç°å¹¶è¡Œæ¥æ”¶ã€‚</p></blockquote></li></ol><blockquote><p>æ¯”å¦‚1ä¸ªæ¥æ”¶2ä¸ªtopicçš„Kafka InputDStreamå¯ä»¥ä¼˜åŒ–ä¸º2ä¸ªInputDStreamï¼Œå„æ¥æ”¶ä¸€ä¸ªtopicï¼Œç„¶ååœ¨åˆå¹¶ã€‚</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> numStreams = <span class="number">5</span></span><br><span class="line"><span class="keyword">val</span> kafkaStreams = (<span class="number">1</span> to numStreams).map&#123;</span><br><span class="line">    i =&gt; <span class="type">KafkaUtils</span>.createStream(...)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">val</span> unifiedStream = streamingContext.union(kafkaStreams)</span><br><span class="line">unifiedStream.print()</span><br></pre></td></tr></table></figure><ol start="2"><li><p>æ•°æ®å¤„ç†çš„å¹¶å‘åº¦</p><blockquote><p>è°ƒæ•´é€‰é¡¹spark.default.parallelism</p></blockquote></li><li><p>taskå¯åŠ¨çš„é¢å¤–å¼€é”€</p><blockquote><p>å¦‚æœtaskå¯åŠ¨è¿‡äºé¢‘ç¹ï¼ˆæ¯”å¦‚æ¯ç§’50æ¬¡ï¼‰ï¼Œé¢å¤–çš„å¼€é”€å¯èƒ½éå¸¸é«˜ï¼Œç”šè‡³æ— æ³•è¾¾åˆ°å®æ—¶è®¡ç®—è¦æ±‚ã€‚</p></blockquote></li></ol><h3 id="è®¾ç½®åˆç†æ‰¹æ¬¡é—´éš”æ—¶é—´"><a href="#è®¾ç½®åˆç†æ‰¹æ¬¡é—´éš”æ—¶é—´" class="headerlink" title="è®¾ç½®åˆç†æ‰¹æ¬¡é—´éš”æ—¶é—´"></a>è®¾ç½®åˆç†æ‰¹æ¬¡é—´éš”æ—¶é—´</h3><blockquote><p>ä¸€èˆ¬æ¥è¯´çŸ­æ—¶é—´é—´éš”ä¼šå¯¼è‡´æ›´å¤šçš„é¢å¤–å¼€é”€ï¼Œä»¥åŠæ— æ³•å®Œæˆçš„é£é™©ï¼Œæ‰€ä»¥å‰æœŸé‡‡å–ç›¸å¯¹ä¿å®ˆçš„æ–¹æ³•ï¼Œå°†é—´éš”è®¾ç½®ä¸º5~10ç§’ã€‚ç„¶åé€šè¿‡è§‚å¯Ÿè¿è¡Œæ•°æ®ç¡®ä¿ç³»ç»Ÿè¶³å¤Ÿå®æ—¶ï¼Œæ¯ä¸ªé—´éš”çš„å®é™…è®¡ç®—æ—¶é—´è¿œå°äºé—´éš”æ—¶é—´ï¼Œå†é€æ¸ç¼©çŸ­é—´éš”æ—¶é—´ã€‚</p></blockquote>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;spark-streamingçš„çŠ¶æ€æ›´æ–°&quot;&gt;&lt;a href=&quot;#spark-streamingçš„çŠ¶æ€æ›´æ–°&quot; class=&quot;headerlink&quot; title=&quot;spark-streamingçš„çŠ¶æ€æ›´æ–°&quot;&gt;&lt;/a&gt;spark-streamingçš„çŠ¶æ€æ›´æ–°&lt;/h2&gt;&lt;
      
    
    </summary>
    
    
      <category term="spark" scheme="http://www.zzzhy.cn/categories/spark/"/>
    
    
      <category term="tuning" scheme="http://www.zzzhy.cn/tags/tuning/"/>
    
      <category term="scala" scheme="http://www.zzzhy.cn/tags/scala/"/>
    
      <category term="spark" scheme="http://www.zzzhy.cn/tags/spark/"/>
    
      <category term="spark streaming" scheme="http://www.zzzhy.cn/tags/spark-streaming/"/>
    
  </entry>
  
  <entry>
    <title>scala æ—¥å¿—å¤„ç†å®ä¾‹</title>
    <link href="http://www.zzzhy.cn/2019/10/30/scala-log-handle/"/>
    <id>http://www.zzzhy.cn/2019/10/30/scala-log-handle/</id>
    <published>2019-10-29T16:24:31.000Z</published>
    <updated>2019-11-14T16:30:50.269Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>æ—¥å¿—æ ¼å¼</p></blockquote><blockquote><p>100.97.15.241 - - [19/Aug/2016:11:05:47 +0800] â€œGET /view.php HTTP/1.0â€ 200 0 â€œ<a href="http://www.gooogle.cn/search?q=hadoop&quot;" target="_blank" rel="noopener">http://www.gooogle.cn/search?q=hadoop&quot;</a> â€œMozilla/5.0 (compatible;MSIE 10.0;Windows NT 6.2; Trident/6.0â€ â€œ-â€œ</p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. æ€»PVé¡µé¢æµè§ˆé‡    </span></span><br><span class="line">lines.count().print()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. å„IPçš„PVï¼ŒæŒ‰PVå€’åº</span></span><br><span class="line"><span class="comment">//   ç©ºæ ¼åˆ†éš”çš„ç¬¬ä¸€ä¸ªå­—æ®µå°±æ˜¯IP</span></span><br><span class="line">lines.map(line =&gt; &#123;(line.split(<span class="string">" "</span>)(<span class="number">0</span>), <span class="number">1</span>)&#125;).reduceByKey(_ + _).transform(rdd =&gt; &#123;</span><br><span class="line">  rdd.map(ip_pv =&gt; (ip_pv._2, ip_pv._1)).</span><br><span class="line">  sortByKey(<span class="literal">false</span>).</span><br><span class="line">  map(ip_pv =&gt; (ip_pv._2, ip_pv._1))</span><br><span class="line">&#125;).print()</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æœç´¢å¼•æ“PV</span></span><br><span class="line"><span class="keyword">val</span> refer = lines.map(_.split(<span class="string">"\""</span>)(<span class="number">3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆè¾“å‡ºæœç´¢å¼•æ“å’ŒæŸ¥è¯¢å…³é”®è¯ï¼Œé¿å…ç»Ÿè®¡æœç´¢å…³é”®è¯æ—¶é‡å¤è®¡ç®—</span></span><br><span class="line"><span class="comment">// è¾“å‡º(host, query_keys)</span></span><br><span class="line"><span class="keyword">val</span> searchEnginInfo = refer.map(r =&gt; &#123;</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">val</span> f = r.split('/')</span><br><span class="line">    <span class="comment">//æœç´¢å…³é”®å­—çš„key</span></span><br><span class="line">    <span class="keyword">val</span> searchEngines = <span class="type">Map</span>(</span><br><span class="line">        <span class="string">"www.google.cn"</span> -&gt; <span class="string">"q"</span>,</span><br><span class="line">        <span class="string">"www.yahoo.com"</span> -&gt; <span class="string">"p"</span>,</span><br><span class="line">        <span class="string">"cn.bing.com"</span> -&gt; <span class="string">"q"</span>,</span><br><span class="line">        <span class="string">"www.baidu.com"</span> -&gt; <span class="string">"wd"</span>,</span><br><span class="line">        <span class="string">"www.sogou.com"</span> -&gt; <span class="string">"query"</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (f.length &gt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">val</span> host = f(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (searchEngines.contains(host)) &#123;</span><br><span class="line">            <span class="keyword">val</span> query = r.split('?')(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> (query.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">val</span> arr_search_q = query.split('&amp;').filter(_.indexOf(searchEngines(host)+<span class="string">"="</span>) == <span class="number">0</span>)</span><br><span class="line">                <span class="keyword">if</span> (arr_search_q.length &gt; <span class="number">0</span>)</span><br><span class="line">                    (host, arr_search_q(<span class="number">0</span>).split('=')(<span class="number">1</span>))</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    (host, <span class="string">""</span>)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                (host, <span class="string">""</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">            (<span class="string">""</span>, <span class="string">""</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span></span><br><span class="line">        (<span class="string">""</span>, <span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡ºæœç´¢å¼•æ“PV</span></span><br><span class="line">searchEnginInfo.filter(_._1.length &gt; <span class="number">0</span>).map(p =&gt; &#123;(p._1, <span class="number">1</span>)&#125;).reduceByKey(_ + _).print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. å…³é”®è¯PV</span></span><br><span class="line">searchEnginInfo.filter(_._2.length &gt; <span class="number">0</span>).map(p =&gt; &#123;(p._2, <span class="number">1</span>)&#125;).reduceByKey(_ + _).print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. ç»ˆç«¯ç±»å‹PV</span></span><br><span class="line">lines.map(_.split(<span class="string">"\""</span>)(<span class="number">5</span>)).map(agent =&gt; &#123;</span><br><span class="line">    <span class="keyword">val</span> types = <span class="type">Seq</span>(<span class="string">"iPhone"</span>, <span class="string">"Android"</span>)</span><br><span class="line">    <span class="keyword">var</span> r = <span class="string">"Default"</span></span><br><span class="line">    <span class="keyword">for</span> (t &lt;- types) &#123;</span><br><span class="line">        <span class="keyword">if</span> (agent.indexOf(t) != <span class="number">-1</span>)</span><br><span class="line">            r = t</span><br><span class="line">    &#125;</span><br><span class="line">    (r, <span class="number">1</span>)</span><br><span class="line">&#125;).reduceByKey(_ + _).print()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. å„é¡µé¢PV</span></span><br><span class="line">lines.map(line =&gt; &#123;(line.split(<span class="string">"\""</span>)(<span class="number">1</span>).split(<span class="string">" "</span>)(<span class="number">1</span>), <span class="number">1</span>)&#125;).reduceByKey(_ + _).print()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;p&gt;æ—¥å¿—æ ¼å¼&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;100.97.15.241 - - [19/Aug/2016:11:05:47 +0800] â€œGET /view.php HTTP/1.0â€ 200 0 â€œ&lt;a hre
      
    
    </summary>
    
    
      <category term="scala" scheme="http://www.zzzhy.cn/categories/scala/"/>
    
    
      <category term="scala" scheme="http://www.zzzhy.cn/tags/scala/"/>
    
      <category term="spark" scheme="http://www.zzzhy.cn/tags/spark/"/>
    
      <category term="functional programming" scheme="http://www.zzzhy.cn/tags/functional-programming/"/>
    
  </entry>
  
  <entry>
    <title>scala å­¦ä¹ å…¥é—¨</title>
    <link href="http://www.zzzhy.cn/2019/10/30/scala-learning/"/>
    <id>http://www.zzzhy.cn/2019/10/30/scala-learning/</id>
    <published>2019-10-29T16:04:17.000Z</published>
    <updated>2019-11-14T16:30:16.471Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åŸºæœ¬ç±»å‹"><a href="#åŸºæœ¬ç±»å‹" class="headerlink" title="åŸºæœ¬ç±»å‹"></a>åŸºæœ¬ç±»å‹</h2><blockquote><p>å¤§éƒ¨åˆ†éƒ½èƒ½éšå¼è½¬æ¢ï¼ŒByteã€Shortéœ€è¦æ˜¾å¼æŒ‡å®š</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val little : Byte = <span class="number">3</span></span><br><span class="line">val little:Short = <span class="number">3</span></span><br></pre></td></tr></table></figure><blockquote><p>charã€Stringæ”¯æŒ\è½¬ä¹‰</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val a = <span class="string">'a'</span>    <span class="comment">//char = 'a'</span></span><br><span class="line">val str = <span class="string">"hello \101"</span>      <span class="comment">//String=hello A</span></span><br></pre></td></tr></table></figure><blockquote><p>å¸¦å°æ•°ç‚¹çš„é»˜è®¤ä¸ºDoubleï¼Œä»¥Fç»“å°¾è¡¨ç¤ºFloat</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val pi = <span class="number">3.14</span>F</span><br><span class="line">val pi = <span class="number">3.14</span> <span class="comment">// double</span></span><br></pre></td></tr></table></figure><h2 id="å®šä¹‰å‡½æ•°"><a href="#å®šä¹‰å‡½æ•°" class="headerlink" title="å®šä¹‰å‡½æ•°"></a>å®šä¹‰å‡½æ•°</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fun = <span class="function">(<span class="params">v : Int</span>) =&gt;</span> v + <span class="number">1</span>  <span class="comment">//åŒ¿åå‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡</span></span><br><span class="line">def addOne(v : Int) : Int = v + <span class="number">1</span>  <span class="comment">//éåŒ¿åå‡½æ•°</span></span><br></pre></td></tr></table></figure><h2 id="æ§åˆ¶ç»“æ„"><a href="#æ§åˆ¶ç»“æ„" class="headerlink" title="æ§åˆ¶ç»“æ„"></a>æ§åˆ¶ç»“æ„</h2><blockquote><p>ifè¡¨è¾¾å¼</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">val filename = </span><br><span class="line"><span class="keyword">if</span> (!args.isEmpty) args(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">else</span> <span class="string">"default.txt"</span></span><br></pre></td></tr></table></figure><blockquote><p>whileå¾ªç¯</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¡ç®—æœ€å¤§å…¬çº¦æ•°</span></span><br><span class="line">def gcdLoop(x : Long,<span class="attr">y</span>: Long) : Long = &#123;</span><br><span class="line">    <span class="keyword">var</span> a = x</span><br><span class="line">    <span class="keyword">var</span> b = y</span><br><span class="line">    <span class="keyword">while</span> (a != <span class="number">0</span>)&#123;</span><br><span class="line">        val temp = a;</span><br><span class="line">        a = b % a;</span><br><span class="line">        b = temp</span><br><span class="line">    &#125;</span><br><span class="line">    b</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>doâ€¦while</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> line = <span class="string">""</span></span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    line = readLine()</span><br><span class="line">    println(<span class="string">"read:"</span>+line)</span><br><span class="line">&#125;<span class="keyword">while</span>(line != <span class="string">""</span>)</span><br></pre></td></tr></table></figure><blockquote><p>forè¡¨è¾¾å¼</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>( i &lt;- <span class="number">1</span> to <span class="number">4</span>)</span><br><span class="line">    println(<span class="string">"Iteration "</span>+ i)</span><br></pre></td></tr></table></figure><blockquote><p>tryâ€¦catch</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">def g() : Int = &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="number">1</span>/<span class="number">0</span></span><br><span class="line">    &#125;<span class="keyword">catch</span>&#123;</span><br><span class="line">        <span class="keyword">case</span> ex: <span class="function"><span class="params">ArithmeticException</span> =&gt;</span> &#123;</span><br><span class="line">            ex.toString</span><br><span class="line">            <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">case</span> _ :<span class="function"><span class="params">Throwable</span> =&gt;</span> <span class="number">3</span></span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">        println(<span class="string">"finally"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŸºæœ¬æ•°æ®ç»“æ„"><a href="#åŸºæœ¬æ•°æ®ç»“æ„" class="headerlink" title="åŸºæœ¬æ•°æ®ç»“æ„"></a>åŸºæœ¬æ•°æ®ç»“æ„</h2><blockquote><p>æ•°ç»„Arrayï¼šå¯ä¿®æ”¹ï¼Œé€šè¿‡æ‹¬å·()æ¥å¼•ç”¨</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val greeting = <span class="keyword">new</span> <span class="built_in">Array</span>[<span class="built_in">String</span>](<span class="number">2</span>)</span><br><span class="line">greeting(<span class="number">0</span>) = <span class="string">"hello"</span></span><br></pre></td></tr></table></figure><blockquote><p>åˆ—è¡¨Listï¼šåªè¯»</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val numbers = List(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">numbers(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><blockquote><p>å…ƒç»„Tupleï¼šåªè¯»ï¼Œä¸Listç±»ä¼¼ï¼Œå¯ä»¥æ˜¯ä¸åŒå…ƒç´ ,ä¸‹æ ‡ä»1å¼€å§‹</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">val hostPort = (<span class="string">"localhost"</span>,<span class="number">80</span>)</span><br><span class="line">hostPort._1</span><br><span class="line">hostPort._2</span><br></pre></td></tr></table></figure><blockquote><p>é›†åˆSetï¼šåªè¯»ï¼Œæ²¡æœ‰é‡å¤çš„å…ƒç´ </p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Set</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">2</span>)</span><br></pre></td></tr></table></figure><blockquote><p>æ˜ å°„Map:</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">val m = <span class="built_in">Map</span>(<span class="number">1</span> -&gt; <span class="string">"one"</span>,<span class="number">2</span> -&gt; <span class="string">"two"</span>)</span><br><span class="line">m(<span class="number">2</span>)</span><br><span class="line"><span class="comment">//åˆ›å»ºå¯å†™ç‰ˆæœ¬</span></span><br><span class="line">val m = scala.collection.mutable.Map[Int,<span class="built_in">String</span>](<span class="number">1</span> -&gt; <span class="string">"one"</span>,<span class="number">2</span> -&gt; <span class="string">"two"</span>)</span><br><span class="line">m += (<span class="number">3</span> -&gt; <span class="string">"three"</span>)</span><br><span class="line">m(<span class="number">4</span>)=<span class="string">"four"</span></span><br><span class="line">m -= <span class="number">2</span></span><br></pre></td></tr></table></figure><h2 id="å®šä¹‰class"><a href="#å®šä¹‰class" class="headerlink" title="å®šä¹‰class"></a>å®šä¹‰class</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class Hello( _a : Int) &#123;</span><br><span class="line">    private val a = _a;</span><br><span class="line">    println(<span class="string">"initializing...("</span> + _a + â€œï¼‰ â€);</span><br><span class="line">    def add( b : Int) : Int = a + b;</span><br><span class="line">    def <span class="keyword">this</span>() = <span class="keyword">this</span>(<span class="number">0</span>);</span><br></pre></td></tr></table></figure><h2 id="ç»§æ‰¿"><a href="#ç»§æ‰¿" class="headerlink" title="ç»§æ‰¿"></a>ç»§æ‰¿</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class Hello2(a : Int) extends Hello(a) &#123;</span><br><span class="line">    def add(b : Int, <span class="attr">c</span> : Int) : Int = a + b+ c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å•å®ä¾‹å¯¹è±¡"><a href="#å•å®ä¾‹å¯¹è±¡" class="headerlink" title="å•å®ä¾‹å¯¹è±¡"></a>å•å®ä¾‹å¯¹è±¡</h2><blockquote><p>scala ä¸æ”¯æŒstaticå˜é‡ã€æˆå‘˜ï¼Œä½†æä¾›äº†å•ä¾‹å¯¹è±¡ï¼Œç”¨objectæ¥å®šä¹‰</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">object Timer &#123;</span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">    def currentCount() : Long = &#123;</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        count</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Timer.currentCount()</span><br></pre></td></tr></table></figure><blockquote><p>å•ä¾‹å¯¹è±¡å¯ä»¥å’Œç±»å…·æœ‰ç›¸åŒçš„åå­—ï¼Œæ”¾åœ¨åŒä¸€ä¸ªæºæ–‡ä»¶ï¼Œå¯ä»¥ç›¸äº’è®¿é—®å½¼æ­¤çš„privateæ–¹æ³•å’Œå˜é‡ã€‚</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class Bar(foo : String)</span><br><span class="line">object Bar&#123;</span><br><span class="line">    def apply(foo : <span class="built_in">String</span>) = <span class="keyword">new</span> Bar(foo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åŒ¿åå‡½æ•°"><a href="#åŒ¿åå‡½æ•°" class="headerlink" title="åŒ¿åå‡½æ•°"></a>åŒ¿åå‡½æ•°</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(x:Int) =&gt; x+<span class="number">1</span></span><br><span class="line"><span class="keyword">var</span> incr = <span class="function">(<span class="params">x:Int</span>) =&gt;</span> x+<span class="number">1</span></span><br><span class="line">incr(<span class="number">10</span>)</span><br></pre></td></tr></table></figure><h2 id="åŒ¿åå‡½æ•°ä½œä¸ºå‚æ•°"><a href="#åŒ¿åå‡½æ•°ä½œä¸ºå‚æ•°" class="headerlink" title="åŒ¿åå‡½æ•°ä½œä¸ºå‚æ•°"></a>åŒ¿åå‡½æ•°ä½œä¸ºå‚æ•°</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val someNumbers = List(<span class="number">1</span>,<span class="number">3</span>,<span class="number">-2</span>,<span class="number">0</span>)</span><br><span class="line">someNumbers.filter( <span class="function"><span class="params">x</span> =&gt;</span> x &gt; <span class="number">0</span> )</span><br><span class="line"><span class="comment">//å¦‚æœåŒ¿åå‡½æ•°çš„å‚æ•°åªè¢«ä½¿ç”¨ä¸€æ¬¡ï¼Œå¯ä»¥ç›´æ¥å†™å‡½æ•°ä½“ï¼Œç”¨_ä»£æ›¿ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">someNumbers.filter(_ &gt; <span class="number">0</span>)</span><br></pre></td></tr></table></figure><h2 id="å‡½æ•°åµŒå¥—"><a href="#å‡½æ•°åµŒå¥—" class="headerlink" title="å‡½æ•°åµŒå¥—"></a>å‡½æ•°åµŒå¥—</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scala.io.Source</span><br><span class="line">def processFile(filename : <span class="built_in">String</span>)&#123;</span><br><span class="line">    def processLine(line : <span class="built_in">String</span>)&#123;</span><br><span class="line">        println(line)</span><br><span class="line">    &#125;</span><br><span class="line">    Source.fromFile(filename).getLines.foreach(processLine);</span><br><span class="line">&#125;</span><br><span class="line">processFile(<span class="string">"t.scala"</span>)</span><br></pre></td></tr></table></figure><h2 id="éƒ¨åˆ†åº”ç”¨å‡½æ•°"><a href="#éƒ¨åˆ†åº”ç”¨å‡½æ•°" class="headerlink" title="éƒ¨åˆ†åº”ç”¨å‡½æ•°"></a>éƒ¨åˆ†åº”ç”¨å‡½æ•°</h2><blockquote><p>å‡½æ•°çš„å‚æ•°å¯ä»¥åˆ†æ­¥æä¾›</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">def adder(m : Int,<span class="attr">n</span> : Int, <span class="attr">z</span> : Int) : Int = m + n + z</span><br><span class="line">val adder2 = adder(<span class="number">2</span>,<span class="attr">_</span>:Int,<span class="attr">_</span>:Int) <span class="comment">//éƒ¨åˆ†åº”ç”¨å‡½æ•°ï¼Œåªè¾“å…¥å‚æ•°2ï¼Œç”¨_ä»£æ›¿æ²¡æœ‰å‡†å¤‡å¥½çš„å¦ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">val adder3 = add2(<span class="number">3</span>,<span class="attr">_</span>:Int)</span><br><span class="line">adder3(<span class="number">4</span>)  <span class="comment">//9</span></span><br></pre></td></tr></table></figure><h2 id="æŸ¯é‡ŒåŒ–å‡½æ•°currying"><a href="#æŸ¯é‡ŒåŒ–å‡½æ•°currying" class="headerlink" title="æŸ¯é‡ŒåŒ–å‡½æ•°currying"></a>æŸ¯é‡ŒåŒ–å‡½æ•°currying</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//éæŸ¯é‡ŒåŒ–å‡½æ•°</span></span><br><span class="line">def plainSum(x : Int,<span class="attr">y</span> : Int) = x + y;</span><br><span class="line">plainSum(<span class="number">1</span>,<span class="number">2</span>)</span><br><span class="line"><span class="comment">//æŸ¯é‡ŒåŒ–</span></span><br><span class="line">def curriedSum(x:Int)(y:Int) = x + y</span><br><span class="line"><span class="comment">//å¯ä»¥ä¸€æ¬¡è¾“å…¥ä¸¤ä¸ªå‚æ•°æ¥è°ƒç”¨</span></span><br><span class="line">curriedSum(<span class="number">1</span>)(<span class="number">2</span>)</span><br><span class="line">val onePlus = curriedSum(<span class="number">1</span>)_  <span class="comment">//ä½¿ç”¨äº†éƒ¨åˆ†åº”ç”¨å‡½æ•°ç¬¦å·_</span></span><br><span class="line">onePlus(<span class="number">2</span>)</span><br><span class="line">val twoPlus = curriedSum(<span class="number">2</span>)_</span><br><span class="line">twoPlus(<span class="number">3</span>)  <span class="comment">//5</span></span><br></pre></td></tr></table></figure><h2 id="åŒ…"><a href="#åŒ…" class="headerlink" title="åŒ…"></a>åŒ…</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">package org.scala.example</span><br><span class="line">object Color&#123;</span><br><span class="line">    val BLUE = <span class="string">"Blue"</span></span><br><span class="line">    val Green = <span class="string">"Green"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ¨¡å¼åŒ¹é…"><a href="#æ¨¡å¼åŒ¹é…" class="headerlink" title="æ¨¡å¼åŒ¹é…"></a>æ¨¡å¼åŒ¹é…</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">times match&#123;</span><br><span class="line">   <span class="keyword">case</span> <span class="number">1</span> =&gt; <span class="string">"one"</span></span><br><span class="line">   <span class="keyword">case</span> <span class="number">2</span> =&gt; <span class="string">"two"</span></span><br><span class="line">   <span class="keyword">case</span> <span class="function"><span class="params">_</span> =&gt;</span> <span class="string">"some other"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¯¹è±¡åŒ¹é…</span></span><br><span class="line">def bigger(o : Any) : Any = &#123;</span><br><span class="line">   o match &#123;</span><br><span class="line">       <span class="keyword">case</span> i : Int <span class="keyword">if</span> i &gt; <span class="number">0</span> =&gt; i - <span class="number">1</span></span><br><span class="line">       <span class="keyword">case</span> i : <span class="function"><span class="params">Int</span> =&gt;</span> i + <span class="number">1</span></span><br><span class="line">       <span class="keyword">case</span> d: Double <span class="keyword">if</span> d &gt; <span class="number">0.0</span> =&gt; d - <span class="number">0.1</span></span><br><span class="line">       <span class="keyword">case</span> d: <span class="function"><span class="params">Double</span> =&gt;</span> d + <span class="number">0.1</span></span><br><span class="line">       <span class="keyword">case</span> text:<span class="function"><span class="params">String</span> =&gt;</span> text + <span class="string">"s"</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line">val v42 = <span class="number">42</span></span><br><span class="line"><span class="comment">// print Not 42</span></span><br><span class="line">Some(<span class="number">3</span>) match &#123;</span><br><span class="line">   <span class="keyword">case</span> Some(<span class="string">`v42`</span>) =&gt; println(<span class="string">"42"</span>)</span><br><span class="line">   <span class="keyword">case</span> <span class="function"><span class="params">_</span> =&gt;</span> println(<span class="string">"Not 42"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="scalaåº”ç”¨ç¨‹åº"><a href="#scalaåº”ç”¨ç¨‹åº" class="headerlink" title="scalaåº”ç”¨ç¨‹åº"></a>scalaåº”ç”¨ç¨‹åº</h2><blockquote><p>å…¥å£ï¼šå•å®ä¾‹å¯¹è±¡ï¼Œå†…éƒ¨å¿…é¡»æœ‰ä¸€ä¸ªmainæ–¹æ³•ï¼Œmainæœ‰ä¸”ä»…æœ‰ä¸€ä¸ªArray[String]çš„å‚æ•°ï¼Œå¹¶ä¸”è¿”å›Unit</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Hello.scala</span></span><br><span class="line">object Hello&#123;</span><br><span class="line">    def main(args : <span class="built_in">Array</span>[<span class="built_in">String</span>]) &#123;</span><br><span class="line">        <span class="keyword">for</span> (arg &lt;- args)</span><br><span class="line">            println(<span class="string">"hello "</span> + arg)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è¿è¡Œï¼š</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; scala Hello scala spark</span><br><span class="line">//<span class="built_in">print</span></span><br><span class="line">hello scala</span><br><span class="line">hello spark</span><br></pre></td></tr></table></figure><h2 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">scala&gt; <span class="keyword">var</span> more =<span class="number">1</span></span><br><span class="line">more: Int = <span class="number">1</span></span><br><span class="line">scala&gt; val addMore = <span class="function">(<span class="params">x:Int</span>) =&gt;</span> x + more</span><br><span class="line">addMore: <span class="function"><span class="params">Int</span> =&gt;</span> Int = <span class="xml"><span class="tag">&lt;<span class="name">function1</span>&gt;</span></span></span><br><span class="line"><span class="xml">scala&gt; addMore (100)</span></span><br><span class="line"><span class="xml">res1: Int = 101</span></span><br><span class="line"><span class="xml">//addMoreä¸ºé—­åŒ…ï¼Œå¼•ç”¨äº†å¤–éƒ¨å˜é‡moreã€‚å½“è¿™ä¸ªè‡ªç”±å˜é‡å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒScala çš„é—­åŒ…èƒ½å¤Ÿæ•è·åˆ°è¿™ä¸ªå˜åŒ–ï¼Œå› æ­¤ Scala çš„é—­åŒ…æ•è·çš„æ˜¯**å˜é‡æœ¬èº«**è€Œä¸æ˜¯å½“æ—¶å˜é‡çš„å€¼ã€‚</span></span><br><span class="line"><span class="xml">scala&gt; more =  9999</span></span><br><span class="line"><span class="xml">more: Int = 9999</span></span><br><span class="line"><span class="xml">scala&gt; addMore ( 10)</span></span><br><span class="line"><span class="xml">res2: Int = 10009</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml">å¦‚æœå˜é‡åœ¨é—­åŒ…åœ¨å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿä¼šåæ˜ åˆ°å‡½æ•°å¤–é¢å®šä¹‰çš„é—­åŒ…çš„å€¼ã€‚æ¯”å¦‚ï¼š</span></span><br><span class="line"><span class="xml">scala&gt; val someNumbers = List ( -11, -10, -5, 0, 5, 10)</span></span><br><span class="line"><span class="xml">someNumbers: List[Int] = List(-11, -10, -5, 0, 5, 10)</span></span><br><span class="line"><span class="xml">scala&gt; var sum =0</span></span><br><span class="line"><span class="xml">sum: Int = 0</span></span><br><span class="line"><span class="xml">scala&gt; someNumbers.foreach ( sum += _)</span></span><br><span class="line"><span class="xml">scala&gt; sum</span></span><br><span class="line"><span class="xml">res4: Int = -11</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;åŸºæœ¬ç±»å‹&quot;&gt;&lt;a href=&quot;#åŸºæœ¬ç±»å‹&quot; class=&quot;headerlink&quot; title=&quot;åŸºæœ¬ç±»å‹&quot;&gt;&lt;/a&gt;åŸºæœ¬ç±»å‹&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;å¤§éƒ¨åˆ†éƒ½èƒ½éšå¼è½¬æ¢ï¼ŒByteã€Shortéœ€è¦æ˜¾å¼æŒ‡å®š&lt;/p&gt;
&lt;/blockquote&gt;
&lt;fig
      
    
    </summary>
    
    
      <category term="scala" scheme="http://www.zzzhy.cn/categories/scala/"/>
    
    
      <category term="scala" scheme="http://www.zzzhy.cn/tags/scala/"/>
    
  </entry>
  
</feed>
